\mychapter{Physics, Engineering and Other Models}
\label{chap:models}

There are a great number of individual models within \process, characterising
many different aspects of a fusion power plant. Several of these will always
be used by the code and so require no input by the user to activate them.
However, in many cases there is a choice of model available, and each of these
has its own user-controlled switches or flags. This chapter summarises these
models, and indicates their location and interaction within the code, together
with the relevant switch settings and required parameter values. The concepts
used (iteration variables, constraint equations, etc.), and instructions on
how to set switches, etc., are explained fully in Chapter~\ref{chap:overview}.

\textbf{Disclaimer: Users are discouraged from using non-default or older
models, as they are likely to be less well tested than the default models and
should therefore be treated with caution.}

\section{Tokamak Power Plant}

The default (and most detailed) power plant model in \process\ is based on the
tokamak magnetic-confinement fusion concept. This section describes the models
relevant to such a plant in some detail, starting with the plasma at the
centre of the fusion power core, and moving outwards to the external
components, power subsystems and buildings. However, many of these models are
also partly or wholly relevant for the other available machine types,
especially outside the fusion power core. The specific details for these
alternative models are introduced later in the Chapter.

\subsection{Radial and vertical build}

Figure~\ref{fig:build_d} shows schematically the layout of a typical tokamak
as modelled by \process. This is the so-called `build' of the machine --- the
relative locations of the major components. Their positions are referenced to
the $(R,Z)$ coordinate system, where $R$ is the radial distance from the
vertical centreline (axis) of the torus, and $Z$ is the vertical distance from
the equatorial midplane, about which the machine is assumed to be up-down
symmetrical (by default; the vertical build is slightly different for single
null plasma devices --- see Figure~\ref{fig:buildsnd}). Components are often
referred to as being `inboard' or `outboard', which simply means that they lie
at a radius $R$ less than or greater than $R_0$, respectively, where $R_0$ is
the plasma major radius (\texttt{rmajor}). For the sake of clarity the
thicknesses are not drawn to scale, and the space labelled as the divertor
does not indicate in any way the actual shape of that component.

The first wall, blanket, shield and vacuum vessel may be either D-shaped in
cross-section, or each may be defined by two half-ellipses; compare their
shapes in Figures~\ref{fig:build_d} and~\ref{fig:build_e}. The choice between
these two possibilities is set using input parameter
\texttt{fwbsshape}~\cite{fwbsshape}, which should be \texttt{1} for D-shaped,
or \texttt{2} for ellipses.

\begin{figure}[tbph]
\epsfig{file=build_d.eps,width=170mm}
\caption[Machine build for D-shaped major components]
{\label{fig:build_d} \textit{Schematic diagram of the fusion
    power core of a typical tokamak power plant modelled by \process, showing
    the relative positions of the components. A double null plasma is assumed
    (\texttt{snull=0}) --- compare Figure~\ref{fig:buildsnd}, and the first
    wall, blanket, shield and vacuum vessel are D-shaped in cross-section
    (chosen by setting switch \texttt{fwbsshape=1}) --- compare
    Figure~\ref{fig:build_e}. Also shown are the code variables used to define
    the thicknesses of the components. The arrowed labels adjacent to the axes
    are the total `builds' to that point. The precise locations and sizes of
    the PF coils are calculated within the code (see
    Section~\ref{sec:pfcoils}).}  }
\end{figure}

\begin{figure}[tbph]
\epsfig{file=build_e.eps,width=170mm}
\caption[Machine build for elliptical-shaped major components]
{\label{fig:build_e} \textit{Schematic diagram of the fusion
    power core of a typical tokamak power plant modelled by \process. The
    first wall, blanket, shield and vacuum vessel cross-sectional shapes are
    each assumed to be defined by two ellipses (chosen by setting switch
    \texttt{fwbsshape=2}) --- compare Figure~\ref{fig:build_d}.}  }
\end{figure}

Most of the thicknesses shown in Figures~\ref{fig:build_d} and~\ref{fig:build_e}
are input parameters, so are not changed during the course of the simulation.
The rest are calculated by the code during execution. In addition, some of the
component sizes can be used as \textit{iteration variables}\/ (see
Section~\ref{sec:itvars}) to help in the optimisation process.

\begin{figure}[tbph]
\epsfig{file=build_e_snd.eps,height=200mm}
\caption[Machine build for a single-null device]
{\label{fig:buildsnd}
  \textit{Schematic diagram of the fusion power core of a typical tokamak
    power plant modelled by \process, showing the relative positions of the
    components. A single null plasma is assumed (\texttt{snull=1}) --- compare
    Figure~\ref{fig:build_e}. The radial build is the same as for a double null
    configuration; shown along the vertical axis are the code variables used
    to define the vertical thicknesses of the components. The arrowed labels
    adjacent to the axis are the total `builds' (distance from the midplane,
    Z=0) to that point. The precise locations and sizes of the  PF coils are
    calculated within the code (see Section~\ref{sec:pfcoils}).}
}
\end{figure}

\subsection{Plasma physics models}

Arguably, the most important component of the machine is the plasma itself. By
default, this is assumed to have an up-down asymmetric, single null
configuration (although this can be changed if desired --- see
Section~\ref{sec:divertor}). A great number of physics models are coded within
\process\ to describe the behaviour of the plasma parameters such as its
current, temperature, density, pressure, confinement etc., and also the
various limits that define the stable operating domain.

\subsubsection{Plasma geometry}
\label{sec:plasma_geometry}

The plasma (geometric) major radius $R_0$ (\texttt{rmajor}) and aspect ratio
$A$ (\texttt{aspect}) define the size of the plasma torus. The plasma minor
radius $a$ (\texttt{rminor}) is calculated from these values. The shape of the
plasma cross-section is given by its last closed flux surface (LCFS) elongation
$\kappa$ (\texttt{kappa}) and triangularity $\delta$ (\texttt{triang}), which
can be scaled automatically with the aspect ratio if required using switch
\texttt{ishape}:

\begin{itemize}

\item If \texttt{ishape = 0}, the input values for \texttt{kappa} and
  \texttt{triang} are used directly.

\item If \texttt{ishape = 1}, the following scaling is used, which is suitable
  for low aspect ratio machines ($\epsilon = 1/A$)~\cite{storac}:

\begin{eqnarray}
\kappa & = & 2.05 \, (1 + 0.44 \, \epsilon^{2.1}) \\
\delta & = & 0.53 \, (1 + 0.77 \, \epsilon^3)
\end{eqnarray}

\item If \texttt{ishape = 2}, the Zohm ITER scaling~\cite{Zohm} is used to
  calculate the elongation:
\begin{equation}
\kappa = \mathrm{minimum} \left( 2.0, \, \, 1.5 + \frac{0.5}{A-1} \right)
\end{equation}
while the input value of the triangularity is used unchanged.

\end{itemize}

If \texttt{ishape = 0, 1} or \texttt{2}, the values for the plasma shaping
parameters at the 95\% flux surface are calculated as
follows~\cite{DEMOPhysicsGuidelines}:
\begin{eqnarray}
\kappa_{95} & = & \kappa / 1.12 \label{eqn:k95} \\
\delta_{95} & = & \delta / 1.5 \label{eqn:d95}
\end{eqnarray}

\begin{itemize}

\item If \texttt{ishape = 3}, the Zohm ITER scaling~\cite{Zohm} is used to
  calculate the elongation (as for \texttt{ishape = 2} above), but the
  triangularity at the 95\% flux surface is input via variable
  \texttt{triang95}, and the LCFS triangularity \texttt{triang} is calculated
  from it, rather than the other way round.

\item Finally, if \texttt{ishape = 4}, the 95\% flux surface values
  \texttt{kappa95} and \texttt{triang95} are both used as inputs, and the LCFS
  values are calculated from them by inverting Equations~\ref{eqn:k95} and~\ref{eqn:d95}.

\end{itemize}

A constraint relating to the plasma's vertical stability may be turned on if
required. In principle, the inner surface of the outboard shield could be used
as the location of a conducting shell which should mitigate the vertical
displacement growth rate of plasmas with significant
elongation~\cite{Sakamoto}. The maximum distance $r_{\mbox{\scriptsize shell,
  max}}$ of this shell from the centre of the plasma may be set using input
parameter \texttt{cwrmax}, such that $r_{\mbox{\scriptsize shell, max}} = $
\texttt{cwrmax*rminor}. Constraint equation no.\ 23 should be turned on with
iteration variable no.\ 104 (\texttt{fcwr}) to enforce this. (A scaling of
\texttt{cwrmax} with elongation should be available shortly.)

The plasma surface area, cross-sectional area and volume are calculated using
formulations that approximate the LCFS as a revolution of two arcs which
intersect the plasma X-points and the plasma midplane outer and inner
radii. (This is a reasonable assumption for double-null diverted plasmas, but
will be inaccurate for single-null plasmas, \texttt{snull = 1}.) Switch
\texttt{igeom} determines whether an old method is used (\texttt{igeom = 0})
or calculations based on a more recent derivation (\texttt{igeom =
  1})~\cite{logbook14_41}.

\subsubsection{Fusion reactions}
\label{sec:fusion_reactions}

The most likely fusion reaction to be utilised in a power plant is the
deuterium-tritium reaction:
\begin{equation}
\mathrm{D + T} \Longrightarrow \mathrm{^{4}He + n + 17.6 \,MeV}
\label{eqn:d-t}
\end{equation}
20\% of the energy produced is given to the alpha particles ($^4$He), which
remain (\Red{but c.f.\ falpha}) within the plasma and thermalise (slow down)
due to collisions, thus heating the plasma. The remaining 80\% is carried away
by the neutrons, which deposit their energy within the blanket and shield.

\process\ can also model D-$^3$He power plants, which utilise the following primary
fusion reaction:
\begin{equation}
\mathrm{D + \mbox{$^3$He}} \Longrightarrow \mathrm{^{4}He + p + 18.3 \,MeV}
\label{eqn:dhe3}
\end{equation}
The fusion reaction rate is significantly different to that for D-T fusion,
and the power flow from the plasma is modified since charged particles are
produced rather than neutrons. Because only charged particles (which remain in
the plasma) are produced by this reaction, the whole of the fusion power is
used to heat the plasma. Useful energy is extracted from the plasma since the
radiation power produced is very high, and this can be converted to
electricity in a number of ways.

Since the temperature required to ignite the D-$^3$He reaction is considerably
higher than that for D-T, it is necessary to take into account the following
D-D reactions, which have significant reaction rates at such temperatures:
\begin{eqnarray}
\mathrm{D + D} & \Longrightarrow & \mathrm{^{3}He + n + 3.27 \,MeV} \\
\mathrm{D + D} & \Longrightarrow & \mathrm{T + p + 4.03 \,MeV}
\end{eqnarray}
Also, as tritium is produced by the latter reaction, D-T fusion is also
possible. As a result, there is still a small amount of neutron power
extracted from the plasma.

Pure D-$^3$He tokamak power plants do not include blankets, because of the near
absence of neutrons leaving the plasma, and the fact that no tritium needs to
be produced for fuel.

The contributions from all four of the above fusion reactions are included in
the total fusion power production calculation. The fusion reaction rates are
calculated using the parametrizations in~\cite{BoschHale}, integrated over the
plasma profiles (correctly, with or without pedestals).

The fractional composition of the ``fuel'' ions (D, T and $^3$He) is
controlled using the three variables \texttt{fdeut}, \texttt{ftrit} and
\texttt{fhe3}, respectively:
\begin{eqnarray*}
n_{\mbox{\scriptsize fuel}} & = & n_D + n_T + n_{\mathrm{^{3}He}}  \;\;\; \mbox{particles/m$^3$} \\
n_D & = & \mathtt{fdeut} \, n_{\mbox{\scriptsize fuel}} \\
n_T & = & \mathtt{ftrit} \, n_{\mbox{\scriptsize fuel}} \\
n_{\mathrm{^{3}He}} & = & \mathtt{fhe3} \, n_{\mbox{\scriptsize fuel}}
\end{eqnarray*}
\process\ checks that \texttt{fdeut + ftrit + fhe3 = 1.0}, and stops with an
error message otherwise.

\subsubsection{Plasma profiles}

By default \Red{NOT ANY MORE!} (switch \texttt{ipedestal = 0}), the plasma
profiles are assumed to be parabolic, i.e.\ they are of the form
\begin{eqnarray}
\mbox{Density : } n(\rho) & = & n_0 \left( 1 - \rho^2 \right)^{\alpha_n} \\
\mbox{Temperature : } T(\rho) & = & T_0 \left( 1 - \rho^2 \right)^{\alpha_T} \\
\mbox{Current : } J(r) & = & J_0 \left( 1 - \rho^2 \right)^{\alpha_J}
\end{eqnarray}
where $\rho = r/a$, and $a$ is the plasma minor radius. This gives
volume-averaged values $\langle n \rangle = n_0 / (1+\alpha_n)$, and
line-averaged values $\bar{n} \sim n_0 / \sqrt{(1+\alpha_n)}$, etc.  These
volume- and line-averages are used throughout the code along with the profile
indices $\alpha$, in the various physics models, many of which are fits to
theory-based or empirical scalings. Thus, the plasma model in \process\ may
be described as ``$\frac{1}{2}$-D''.  The relevant profile index variables are
\texttt{alphan}, \texttt{alphat} and \texttt{alphaj}, respectively (see
Section~\ref{sec:current_profile}).

If \texttt{ipedestal} is set to \texttt{1}, however, the density and
temperature profiles may include a pedestal, using the forms specified
in~\cite{helios}:
\begin{equation}
\mbox{density:} \qquad n(\rho) = \left\{ 
\begin{aligned}
  &n_{ped} + (n_0 - n_{ped}) \left( 1 -
    \frac{\rho^2}{\rho_{ped,n}^2}\right)^{\alpha_n}
  &\qquad 0 \leq \rho \leq \rho_{ped,n} \\
  &n_{sep} + (n_{ped} - n_{sep})\left( \frac{1- \rho}{1-\rho_{ped,n}}\right)
  &\qquad \rho_{ped,n} < \rho \leq 1
\end{aligned}
\right.
\end{equation}

\begin{equation}
\mbox{temperature:} \qquad T(\rho) = \left\{ 
\begin{aligned}
  &T_{ped} + (T_0 - T_{ped}) \left( 1 - \frac{\rho^{\beta_T}}
    {\rho_{ped,T}^{\beta_T}}\right)^{\alpha_T} &\qquad 0 \leq \rho \leq \rho_{ped,T} \\
  &T_{sep} + (T_{ped} - T_{sep})\left( \frac{1- \rho}{1-\rho_{ped,T}}\right)
  &\qquad \rho_{ped,T} < \rho \leq 1
\end{aligned}
\right.
\end{equation}
Subscripts $0$, $ped$ and $sep$, denote values at the centre ($\rho = 0$), the
pedestal ($\rho = \rho_{ped}$) and the separatrix ($\rho=1$),
respectively. The density and temperature peaking parameters $\alpha_n$ and
$\alpha_T$ as well as the second exponent $\beta_T$ (input parameter
\texttt{tbeta}, not to be confused with the plasma beta) in the temperature
profile can be chosen by the user, as can the pedestal heights and the values
at the separatrix (\texttt{neped, nesep} for the electron density, and
\texttt{teped, tesep} for the electron temperature; the ion equivalents are
scaled from the electron values by the ratio of the volume-averaged values).
The density at the centre is given by
\begin{eqnarray}
  \nonumber
  n_0 &= & \frac{1}{3\rho_{ped,n}^2} \left[3\langle n\rangle (1+\alpha_n)
    + n_{sep} (1+\alpha_n) (-2 + \rho_{ped,n} + \rho_{ped,n}^2) \right.\\
  && \left. - n_{ped}\left( (1 + \alpha_n)(1+ \rho_{ped,n}) + (\alpha_n -2)
    \rho_{ped,n}^2 \right) \right]
\end{eqnarray}
where $\langle n \rangle$ is the volume-averaged density. The temperature at
the centre is given by
\begin{equation}
T_0 = T_{ped} + \gamma \left[ T_{ped}\, \rho_{ped,T}^2 - \langle T \rangle +
  \frac{1}{3}(1 - \rho_{ped,T}) \left[ \, (1 + 2\rho_{ped,T}) \, T_{ped} + ( 2 +
    \rho_{ped,T}) \, T_{sep} \, \right] \right]
\end{equation}
with 
\begin{equation}
\gamma = \left\{ 
\begin{aligned}
  &\frac{ -\Gamma(1+\alpha_T+2/\beta_T)}
  {\rho_{ped,T}^2 \, \Gamma(1+\alpha_T) \, \Gamma((2+\beta_T)/\beta_T)}
  &\qquad \textnormal{for integer } \alpha_T \\
  &\frac{\Gamma(-\alpha_T)\sin(\pi\alpha)\, \Gamma(1+\alpha_T+2/\beta_T)}
  {\pi\rho_{ped,T}^2 \, \Gamma((2+\beta_T)/\beta_T)}
  &\qquad \textnormal{for non-integer } \alpha_T
\end{aligned}
\right.
\end{equation}
where $\Gamma$ is the gamma function.

Note that both density and temperature can have different pedestal positions
$\rho_{ped,n}$ (\texttt{rhopedn}) and $\rho_{ped,T}$ (\texttt{rhopedt}) in
agreement with simulations.

\subsubsection{Beta limits}

The plasma beta limit~\cite{IPDG,172} is given by
\begin{equation}
\langle \beta \rangle < g \, \frac{I(\mbox{MA})}{a(\mbox{m}) \, B_0(\mbox{T})}
\label{eqn:troyon}
\end{equation}
where $B_0$ is the axial vacuum toroidal field, and $\beta$ is defined with
respect to the total equilibrium $\mathbf{B}$-field~\cite{172}. The beta
coefficient $g$ is set using input parameter \texttt{dnbeta} (but see
Section~\ref{sec:current_profile}). To apply the beta limit, constraint
equation no.\ 24 should be turned on with iteration variable no.\ 36
(\texttt{fbetatry}). The limit can be applied to either the total plasma beta,
in which case switch \texttt{iculbl} should be set to 0, to only the thermal
component of the plasma beta, in which case \texttt{iculbl} should be set to
1, or to the thermal plus neutral beam components, in which case
\texttt{iculbl} should be set to 2.

\subsubsection*{Aspect ratio scaling of beta $g$ coefficient}

Switch \texttt{gtscale} determines whether the beta $g$ coefficient
\texttt{dnbeta} should scale with aspect ratio ($\mathtt{gtscale \not= 0}$),
or be fixed at the input value (\texttt{gtscale = 0}). Note that
\texttt{gtscale} is over-ridden if \texttt{iprofile = 1} (see
Section~\ref{sec:current_profile}).

\subsubsection*{Limiting $\epsilon.\beta_p$}

To apply a limit to the value of $\epsilon.\beta_p$, where $\epsilon = a/R$ is
the inverse aspect ratio, constraint equation no.\ 6 should be turned on with
iteration variable no.\ 8 (\texttt{fbeta}). The limiting value of
$\epsilon.\beta_p$ should be set using input parameter \texttt{epbetmax}.

\subsubsection{Density limits}

Several density limit models~\cite{172} are available in \process. These are
calculated in routine \texttt{CULDLM}, which is called by \texttt{PHYSICS}.
To enforce any of these limits, turn on constraint equation no.~5 with
iteration variable no.~9 (\texttt{fdene}).  In addition, switch
\texttt{idensl} must be set to the relevant value, as follows:-
\begin{description} %!%!%! find refs
\item [\texttt{idensl = 1} :] ASDEX model
\item [\texttt{idensl = 2} :] Borrass model for ITER, I
\item [\texttt{idensl = 3} :] Borrass model for ITER, II
\item [\texttt{idensl = 4} :] JET edge radiation model
\item [\texttt{idensl = 5} :] JET simplified model
\item [\texttt{idensl = 6} :] Hugill-Murakami $M.q$ model
\item [\texttt{idensl = 7} :] Greenwald model
\end{description}

\subsubsection{Impurities and radiation}
\label{sec:radiation}

The impurity radiation model in \process\/ can be chosen using the switch
\texttt{imprad\_model}, where \texttt{imprad\_model = 0} gives the original
ITER 1989 model~\cite{kovari_physics}, and \texttt{imprad\_model = 1} uses a
multi-impurity model which integrates the radiation contributions over an
arbitrary choice of density and temperature profiles~\cite{hanni_radiation}.

If \texttt{imprad\_model = 0}, the impurity species and fractions are chosen
using input parameters \texttt{impc}, \texttt{impo}, \texttt{fbfe},
\texttt{cfe0} and \texttt{zfear}; see the variable descriptor file for more
details.

If \texttt{imprad\_model = 1}, the impurity number density fractions relative
to the electron density are set using input array \texttt{fimp(1 to nimp)},
where \texttt{nimp = 14} is the number of impurity species in the radiation
model. The available impurities are as follows:
\begin{enumerate}
\item Hydrogen (fraction calculated by code)
\item Helium (fraction calculated by code)
\item Beryllium
\item Carbon
\item Nitrogen
\item Oxygen
\item Neon
\item Silicon
\item Argon
\item Iron
\item Nickel
\item Krypton
\item Xenon
\item Tungsten
\end{enumerate}
As stated above, the number density fractions for hydrogen (all isotopes) and
helium need not be set, as they are calculated by the code to ensure that
plasma quasi-neutrality is maintained, and taking into account the fuel ratios
\texttt{fdeut}, \texttt{ftrit} and \texttt{fhe3} (see
Section~\ref{sec:fusion_reactions}), and the alpha particle fraction
\texttt{ralpne} which may be input by the user.

The impurity fraction of one of the elements listed in array \texttt{fimp} may
be used as an iteration variable (although it will only have any effect if
\texttt{imprad\_model = 1}). The element to use is specified using input
parameter \texttt{impvar}, which may be set to a value between 3 and
\texttt{nimp}, and the initial estimate to use for the element's impurity
fraction must be set using iteration variable no.\ 102 (\texttt{fimpvar}).

The synchrotron radiation power~\cite{albajar, fidone} is assumed to originate
from the plasma core. The wall reflection factor \texttt{ssync} may be set by
the user.

By changing the input parameter \texttt{coreradius}, the user may set the
normalised radius defining the core region (\texttt{imprad\_model = 1}
only). Only the impurity and synchrotron radiation from the core region
affects the confinement scaling (but see \texttt{iradloss} below), while the
power flowing into the divertor is assumed to exclude all radiation power.

\Red{Add radiation power flow diagram as on p.26, logbook24}

\Red{New overall power flow diagram should elucidate this...}

Constraint equation no.~17 with iteration variable no.~28 (\texttt{fradpwr})
ensures that the calculated total radiation power does not exceed the total
power available that can be converted to radiation (i.e.\ the sum of the fusion
alpha power, other charged particle fusion power, auxiliary injected power and
the ohmic power). This constraint should always be turned on.

Switch \texttt{iradloss} may be used to exclude (\texttt{iradloss = 1},
default) or include (\texttt{iradloss = 0}) the core radiation power in the
transport power used in the confinement time and power balance calculations
(see Section~\ref{sec:corepower}).

\subsubsection{Plasma current scaling laws}
\label{sec:current_scaling}

A number of plasma current scaling laws exploiting the inverse relationship
between plasma current and edge safety factor $q_{\psi}$~\cite{172} are
available in \process. These are calculated in routine \texttt{CULCUR}, which
is called by \texttt{PHYSICS}.  Flag \texttt{icurr} must be set to the
relevant value, as follows:-
\begin{description}
\item [\texttt{icurr = 1} :] Peng analytic fit
\item [\texttt{icurr = 2} :] Peng double null divertor scaling (ST)~\cite{storac}
\item [\texttt{icurr = 3} :] Simple ITER scaling
\item [\texttt{icurr = 4} :] Revised ITER scaling~\cite{Uckan88}
\item [\texttt{icurr = 5} :] Todd empirical scaling, I
\item [\texttt{icurr = 6} :] Todd empirical scaling, II
\item [\texttt{icurr = 7} :] Connor-Hastie model
\end{description}

\subsubsection{Plasma current profile consistency}
\label{sec:current_profile}

Self-consistency between the plasma current profile
parameters~\cite{DEMOPhysicsGuidelines} can be enforced by setting switch
\texttt{iprofile} to 1. This ensures that the current profile peaking factor
\texttt{alphaj} is consistent with the input values for the safety factor on
axis and at the plasma edge (\texttt{q0} and \texttt{q}, respectively), the
plasma internal inductance $l_i$ is consistent with this \texttt{alphaj}, and
the beta $g$ coefficient \texttt{dnbeta} scales with $l_i$.

It is recommended that current scaling law \texttt{icurr = 4} is used if
\texttt{iprofile = 1}. Switch \texttt{gtscale} is over-ridden if
\texttt{iprofile = 1}.

\subsubsection{Confinement time scaling laws}
\label{sec:taue}

The particle transport loss power in Watts/m$^3$ from the plasma is defined as
\begin{equation}
P_{\mbox{\scriptsize loss}} = \frac{W}{\tau_E}
\label{eqn:ploss}
\end{equation}
where the plasma stored energy per unit volume $W$ is given by
\[
W = \frac{3}{2} \,n \, e \, T
\]
with particle number density $n$ in m$^{-3}$ and particle temperature $T$ in
eV. \process\ assumes that the electron and ion energy confinement times
$\tau_E$ are equal.

Many energy confinement time scaling laws are present within \process, for
tokamaks, RFPs or stellarators. These are calculated in routine
\texttt{PCOND}. The value of \texttt{isc} determines which of the scalings is
used in the plasma energy balance calculation (Section~\ref{sec:corepower}).
Table~\ref{tab:scaling_laws} summarises the available scaling laws.

% Table summarising confinement time scaling laws in PROCESS.
\begin{table}[tbph]
\begin{center}
\footnotesize
\begin{tabular}{||c||l|l||} \hline
\texttt{isc} & scaling law & reference \\ \hline
\texttt{1}  & Neo-Alcator (ohmic) & \cite{IPDG} \\
\texttt{2}  & Mirnov (H-mode) & \cite{IPDG} \\
\texttt{3}  & Merezhkin-Muhkovatov (L-mode) & \cite{IPDG} \\
\texttt{4}  & Shimomura (H-mode) & JAERI-M 87-080 (1987) \\
\texttt{5}  & Kaye-Goldston (L-mode) & Nuclear Fusion \textbf{25} (1985) p.65 \\
\texttt{6}  & ITER 89-P (L-mode) & Nuclear Fusion \textbf{30} (1990) p.1999 \\
\texttt{7}  & ITER 89-O (L-mode) & \cite{IPDG} \\
\texttt{8}  & Rebut-Lallia (L-mode) & Plasma Physics and Controlled Nuclear Fusion
Research \\
 & &  \textbf{2} (1987) p. 187 \\
\texttt{9}  & Goldston (L-mode) & Plas.\ Phys.\ Controlled Fusion \textbf{26} (1984) p.87 \\
\texttt{10} & T10 (L-mode) & \cite{IPDG} \\
\texttt{11} & JAERI-88 (L-mode) & JAERI-M 88-068 (1988) \\
\texttt{12} & Kaye-Big Complex (L-mode) & Phys.\ Fluids B \textbf{2} (1990) p.2926 \\
\texttt{13} & ITER H90-P (H-mode) &  \\
\texttt{14} & ITER Mix (minimum of \texttt{6} and \texttt{7}) &  \\
\texttt{15} & Riedel (L-mode) &  \\
\texttt{16} & Christiansen et al. (L-mode) & JET Report JET-P (1991) 03 \\
\texttt{17} & Lackner-Gottardi (L-mode) & Nuclear Fusion \textbf{30} (1990) p.767  \\
\texttt{18} & Neo-Kaye (L-mode) & \cite{IPDG} \\
\texttt{19} & Riedel (H-mode) &  \\
\texttt{20} & ITER H90-P (amended) & Nuclear Fusion \textbf{32} (1992) p.318 \\
\texttt{21} & Large Helical Device (stellarator) & Nuclear Fusion \textbf{30} (1990)
p.11 \\
\texttt{22} & Gyro-reduced Bohm (stellarator) & Bull. Am. Phys. Society, \textbf{34}
(1989) p.1964 \\
\texttt{23} & Lackner-Gottardi (stellarator) & Nuclear Fusion \textbf{30} (1990) p.767 \\
\texttt{24} & ITER-93H (H-mode) & Plasma Physics and Controlled Nuclear Fusion
Research \\
 & & (Proc. 15th Int. Conf., Seville, 1994) IAEA-CN-60/E-P-3 \\
\texttt{25} & TITAN (RFP) & TITAN RFP Fusion Reactor Study, Scoping Phase
Report \\
 & & UCLA-PPG-1100, page 5--9, Jan 1987 \\
\texttt{26} & ITER H-97P ELM-free (H-mode) & J. G. Cordey et al., EPS
Berchtesgaden, 1997 \\
\texttt{27} & ITER H-97P ELMy (H-mode) & J. G. Cordey et al., EPS
Berchtesgaden, 1997 \\
\texttt{28} & ITER-96P (= ITER97-L) (L-mode) & Nuclear Fusion \textbf{37} (1997) p.1303 \\
\texttt{29} & Valovic modified ELMy (H-mode) &  \\
\texttt{30} & Kaye PPPL April 98 (L-mode) &  \\
\texttt{31} & ITERH-PB98P(y) (H-mode) &  \\
\texttt{32} & IPB98(y) (H-mode) & Nuclear Fusion \textbf{39} (1999) p.2175 \\
\texttt{33} & IPB98(y,1) (H-mode) & Nuclear Fusion \textbf{39} (1999) p.2175 \\
\texttt{34} & IPB98(y,2) (H-mode) & Nuclear Fusion \textbf{39} (1999) p.2175 \\
\texttt{35} & IPB98(y,3) (H-mode) & Nuclear Fusion \textbf{39} (1999) p.2175 \\
\texttt{36} & IPB98(y,4) (H-mode) & Nuclear Fusion \textbf{39} (1999) p.2175 \\
\texttt{37} & ISS95 (stellarator) & Nuclear Fusion \textbf{36} (1996) p.1063 \\
\texttt{38} & ISS04 (stellarator) & Nuclear Fusion \textbf{45} (2005) p.1684 \\
\texttt{39} & DS03 (H-mode) & Plasma Phys.\ Control.\ Fusion \textbf{50} (2008) 043001, equation 4.13 \\
\hline
\end{tabular}
\normalsize
\end{center}
\caption[List of available energy confinement scaling laws]
{\label{tab:scaling_laws}
  \textit{Summary of the energy confinement time scaling laws in \process.}
}
\end{table}

\subsubsection{Plasma core power balance}
\label{sec:corepower}

Figure~\ref{fig:powerflow1} shows schematically the flow of power within the
plasma as calculated by the code. (Figures~\ref{fig:powerflow2} and
\ref{fig:powerflow3} show the power transfer mechanisms for the remainder of
the power plant.)

\begin{figure}[tbph]
\epsfig{file=powerflow1.eps,width=170mm}
\caption[Power balance within the core plasma] {\label{fig:powerflow1}
  \textit{Schematic diagram of the flow of power within the plasma
    core. Variable names are given in [\ldots]. Refer to
  Figure~\ref{fig:powerflow2} for the onward flow of power from the three
  red-bordered boxes, while the source of the power in the blue box is
  indicated in Figure~\ref{fig:powerflow3}.} }
\end{figure}

The primary sources of power are the fusion reactions themselves, ohmic power
due to resistive heating within the plasma, and any auxiliary power provided
for heating and current drive (see Section~\ref{sec:hcd}). The power carried
by the fusion-generated neutrons is lost from the plasma, but is deposited in
the surrounding material (see Section~\ref{sec:powerflow}). A fraction
\texttt{falpha} of the alpha particle power is assumed to stay within the
plasma core to contribute to the plasma power balance. The sum of this core
alpha power, any power carried by non-alpha charged particles, the ohmic power
and any injected power, is converted into charged particle transport power
($P_{\mbox{\scriptsize loss}}$ in Equation~\ref{eqn:ploss}) plus core
radiation power (see Section~\ref{sec:radiation}), as shown in
Figure~\ref{fig:powerflow1}. (Note that, if switch \texttt{iradloss} is set to
zero, the above summed input power is converted into charged particle
transport power only, and the core radiation power may be assumed to originate
from the transport power; i.e.\ the core radiation power is treated the same
as the edge radiation power in Figure~\ref{fig:powerflow1} instead of having
an arrow leading directly to it from the core plasma power balance.)

The core power balance calculation is turned on using constraint equation
no.\ 2 (which should therefore always be used).

\subsubsection{Bootstrap current scalings}
\label{sec:bootstrap}

The fraction of the plasma current provided by the so-called bootstrap effect
can be either input into the code directly, or calculated using one of four
methods, as summarised here. Note that methods \texttt{ibss = 1} to~\texttt{3}
use fits to parabolic density and temperature profiles, and do not take into
account the existence of pedestals (\texttt{ipedestal = 1}), whereas the
Sauter et al.\ scaling (\texttt{ibss = 4}) allows general profiles to be used.

\begin{itemize}

\item Direct input: To input the bootstrap current fraction directly, set
  \texttt{bscfmax} to $(-1)$ times the required value.

\item ITER scaling~\cite{IPDG}: To use the ITER scaling method for the
  bootstrap current fraction, set \texttt{ibss = 1}, and \texttt{bscfmax} to
  the maximum required bootstrap current fraction ($\leq 1$). This method is
  valid at high aspect ratio only.

\item General scaling~\cite{Nevins}: To use a more general scaling method, set
  \texttt{ibss = 2}, and \texttt{bscfmax} to the maximum required bootstrap
  current fraction ($\leq 1$).

\item Numerically fitted scaling~\cite{WilsonBS}: To use a numerically fitted
  scaling method, valid for all aspect ratios, set \texttt{ibss = 3}, and
  \texttt{bscfmax} to the maximum required bootstrap current fraction ($\leq
  1$).

\item Sauter, Angioni and Lin-Liu scaling~\cite{SauterBS, SauterBS_errata}:
  Set \texttt{ibss = 4}, and \texttt{bscfmax} to the maximum required
  bootstrap current fraction ($\leq 1$).

\end{itemize}

\subsubsection{L-H power threshold scalings}

Transitions from a standard confinement mode (L-mode) to an improved
confinement regime (H-mode), called L-H transitions, are observed in most
tokamaks. A range of scaling laws are available that provide estimates of the
auxiliary power required to initiate these transitions, via extrapolations
from present-day devices. \process\ calculates these power threshold values
for the scaling laws listed in Table~\ref{tab:power_thresholds}, in
routine~\texttt{PTHRESH}.

To enforce one of these scalings, use input parameter \texttt{ilhthresh} to
select the scaling to use, and turn on constraint equation no.\ 23 with
iteration variable no.\ 104 (\texttt{flhthresh}). By default, this will ensure
that the power reaching the divertor is at least equal to the threshold power
calculated for the chosen scaling, which is a necessary condition for
H-mode. However, for L-mode it might be appropriate to set \texttt{boundl(104)
  = 0.001, boundu(104) = 1.0}, which will ensure that the power threshold does
not exceed the calculated value, and therefore the machine cannot reach
H-mode.

% Table summarising L-H power threshold scalings

\begin{table}[tbph]
\small
\begin{center}
\begin{tabular}{||c||l||l||} \hline
 & name & reference \\ \hline
(1) & 1996 ITER scaling: nominal & ITER Physics Design Description Document, \\
(2) & 1996 ITER scaling: upper bound & D. Boucher, p.2-2 \\
(3) & 1996 ITER scaling: lower bound &  \\ \hline
(4) & 1997 ITER scaling, excluding elongation & J. A. Snipes, ITER H-mode
Threshold Database \\
(5) & 1997 ITER scaling, including elongation &  Working Group, Controlled
Fusion and Plasma \\
 & & Physics, 24th EPS Conference, Berchtesgaden, \\
 & & June 1997, vol.21A, part III, p.961 \\ \hline
(6) & 2008 Martin scaling: nominal & Martin et al, 11th IAEA Tech. Meeting on
H-mode \\
(7) & 2008 Martin scaling: 95\% upper bound &  Physics and Transport Barriers,
Journal of Physics: \\
(8) & 2008 Martin scaling: 95\% lower bound & Conference Series \textbf{123}
(2008) 012033 \\
\hline
\end{tabular}
\end{center}
\normalsize
\caption[List of available L-H power threshold scalings]
{\label{tab:power_thresholds}
  \textit{Summary of the L-H power threshold scalings implemented in \process.}
}
\end{table}

\subsubsection{Other plasma physics options}

\subsubsection*{Neo-classical correction effects}

Switch \texttt{ires} controls whether neo-classical correction
effects~\cite{Uckan} are included in the calculation of the plasma resistance
and ohmic heating power in routine \texttt{POHM}, which is called by routine
\texttt{PHYSICS}. If \texttt{ires = 1}, these effects are included. Note that
the scaling used is only valid for aspect ratios between 2.5 and 4, and it is
possible for the plasma resistance to be wrongly calculated as negative if
\texttt{ires = 1} and the aspect ratio is too high.

\subsubsection*{Inverse quadrature in $\tau_E$ scaling laws}

Switch \texttt{iinvqd} determines whether the energy confinement time scaling
laws (see Section~\ref{sec:taue}) due to Kaye-Goldston (\texttt{isc = 5}) and
Goldston (\texttt{isc = 9}) should include an inverse quadrature scaling with
the Neo-Alcator result (\texttt{isc = 1}). A value \texttt{iinvqd = 1}
includes this scaling.

\subsubsection*{Plasma / first wall gap}

The region directly outside the last closed flux surface of the core plasma is
known as the scrape-off layer, and contains no structural material.  Plasma
entering this region is not confined and is removed by the divertor. \process\
treats the scrape-off layer merely as a gap. Switch \texttt{iscrp} determines
whether the inboard and outboard gaps should be calculated as 10\% of the
plasma minor radius (\texttt{iscrp = 0}), or set equal to the input values
\texttt{scrapli} and \texttt{scraplo} (\texttt{iscrp = 1}).

\subsection{First wall}

The first wall acts as a physical barrier protecting the rest of the machine
from the hot plasma. Due to its hostile environment the first wall has only a
short lifetime and therefore needs to be replaced regularly. Its stainless
steel structure is cooled either by gaseous helium or by pressurised water, as
chosen using switch \texttt{costr} -- see Section~\ref{sec:blanket}.

The first wall coolant fraction is given by the value of \texttt{fwclfr},
which is calculated if a pulsed power plant is being modelled (\texttt{lpulse
  = 1} --- see Section~\ref{sec:pulsed}), and assumed to be the input value
otherwise.

\subsubsection*{Wall load calculation}

Switch \texttt{iwalld} determines whether the neutron wall load (power per
unit area) should be calculated using the plasma surface area (\texttt{iwalld
  = 1}) or the first wall area (\texttt{iwalld = 2}) as the denominator. In
the former case, input parameter \texttt{ffwal} (default value 0.92)
can be used to scale the neutron power reaching the first wall.

\subsection{Divertor}
\label{sec:divertor}

The divertor provides a means of removing plasma reaching the scrape-off layer
and heavy ions that are ejected from the first wall.  By default, two
divertors are assumed in the \process\ tokamak, placed symmetrically above
and below the plasma. The principal outputs from the code are the divertor
heat load, used to determine its lifetime, and its peak temperature. The
divertor is cooled either by gaseous helium or by pressurised water.

Switch \texttt{snull} controls the overall plasma configuration. Setting
\texttt{snull = 0} corresponds to an up-down symmetric, double null
configuration (the default), while \texttt{snull = 1} assumes a single null
plasma with the divertor at the bottom of the machine. The vertical build (see
Figure~\ref{fig:buildsnd}) and PF coil current scaling algorithms take the
value of this switch into account, although not the plasma geometry at
present.

The Harrison-Kukushkin-Hotston divertor model~\cite{IPDG} developed for ITER
is used (except for the case of spherical tokamaks or stellarators --- see
later). This is appropriate for conventional aspect ratio machines, but care
should be taken in inputting the divertor magnetics for this model, and
projections far from the ITER CDA machine parameters are likely to be
unreliable.

\subsection{Blanket}

The blanket performs a number of tasks. An incoming neutron from a
deuterium-tritium (D-T) fusion reaction in the plasma loses energy in the
blanket. This energy is removed by the blanket coolant and used to produce
electricity. The neutron may also react with a lithium nucleus present in the
blanket to produce (``breed'') a tritium nucleus which can be re-used as
fuel. The competing requirements of heating and tritium synthesis mean that a
neutron multiplier must be present, to ensure balance between tritium
destruction and creation. The blanket therefore contains beryllium to fulfil
this purpose. As with the first wall, the blanket has a relatively short
lifetime because of the high neutron fluence.

\subsubsection{Blanket neutronics model}
\label{sec:blanket_neutronics}

Switch \texttt{blktmodel} determines whether a simple blanket neutronics model
or a more comprehensive treatment based on recent full neutronics analyses for
EFDA~\cite{efda_blanket_model} is used.

In the simple model (\texttt{blktmodel = 0}), the overall radial thicknesses
of the inboard and outboard blanket sections are specified via input
parameters \texttt{blnkith} and \texttt{blnkoth}, respectively. The energy
multiplication in the blanket (\texttt{emult}) is also an input
parameter. Steel and vanadium may be used as structural materials within the
blanket, which is cooled either by gaseous helium or by pressurised water. The
nuclear heating of the TF coil superconductor is calculated assuming an
exponential neutron attenuation through the blanket and shield materials,
based on 1990 ITER data.

The more advanced model (\texttt{blktmodel = 1}) allows the energy
multiplication factor \texttt{emult}, the shielding requirements and tritium
breeding ratio to be calculated self-consistently with the blanket and
shielding materials and sub-assembly thicknesses, and for constraints to be
applied to satisfy the engineering requirements. The rest of this section
describes this model in more detail.

The model is based on the Helium-Cooled Pebble Bed (HCPB) blanket concept
developed by KIT (a second advanced model --- Helium-Cooled Lithium Lead, HCLL
--- will be implemented in due course). The blanket, shield and vacuum vessel
are segmented radially into a number of sub-assemblies. Moving in the
direction away from the plasma/first wall, these are:

\begin{itemize}

\item Breeding Zone (BZ) (which includes the first wall), with radial
  thicknesses (inboard and outboard, respectively) \texttt{fwith+blbuith},
  \texttt{fwoth+blbuoth}. This consists of beryllium (with fraction by volume
  \texttt{fblbe}), breeder material (\texttt{fblbreed}), steel
  (\texttt{fblss}) and helium coolant. Three forms of breeder material are
  available: lithium orthosilicate (Li$_4$SiO$_4$) (chosen by setting
  \texttt{breedmat = 1}), lithium metatitanate (Li$_2$TiO$_3$)
  (\texttt{breedmat = 2}) or lithium zirconate (Li$_2$ZrO$_3$)
  (\texttt{breedmat = 3}). The $^6$Li enrichment percentage may be modified
  from the default 30\% using input parameter \texttt{li6enrich}.

\item Box Manifold (BM), with radial thicknesses (inboard and outboard,
  respectively) \texttt{blbmith}, \texttt{blbmoth} and helium fractions
  \texttt{fblhebmi}, \texttt{fblhebmo} (the rest being steel).

\item Back Plate (BP), with radial thicknesses (inboard and outboard,
  respectively) \texttt{blbpith}, \texttt{blbpoth} and helium fractions
  \texttt{fblhebpi}, \texttt{fblhebpo} (the rest being steel).

Together, the BZ, BM and BP make up the `blanket', with total radial
thicknesses \texttt{blnkith} (inboard) and \texttt{blnkoth} (outboard), and
void (coolant) fraction \texttt{vfblkt}; Note that these
quantities are \textit{calculated}\ from the sub-assembly values if
\texttt{blktmodel > 0}, rather than being input parameters.

\item Low Temperature Shield and Vacuum Vessel (lumped together for these
  calculations), with radial thicknesses (inboard and outboard, respectively)
  \texttt{shldith+ddwi}, \texttt{shldoth+ddwi} and \textbf{water} coolant
  fraction \texttt{vfshld} (the rest being assumed to be steel for its mass
  calculation; the neutronics model assumes that the shield contains 2\% boron
  as a neutron absorber, but this material is not explicitly mentioned
  elsewhere in the code --- so its cost is not calculated, for example).

  \textit{N.B.\ The fact that water is assumed to be the coolant in the
    shield, whereas helium is the coolant in the blanket, leads to an
    inconsistency when specifying the coolant type via switch \texttt{costr}
    (see Section~\ref{sec:blanket}). At present we mitigate this by forcing
    \texttt{costr=2} (making water the coolant), as in this case the coolant
    mass and pumping costs are higher, giving the more pessimistic solution
    with regards to costs.}

\end{itemize}

A few other input parameters are useful for tuning purposes, as follows:

\begin{itemize}

\item \texttt{fhole} is the `hole' area fraction of the first wall and blanket
  that neutrons leaving the plasma see, due to the presence of the divertor,
  for instance. That is, \texttt{1-fhole} is the first wall area coverage
  factor. \Red{(N.B.\ see Section~\ref{sec:powerflow}.)}

\item \texttt{fvolsi} and \texttt{fvolso} are the area (and volume) coverage
  factors for the inboard and outboard shields, respectively.

\item \texttt{fvoldw} is a multiplier for the volume of the vacuum vessel,
  used in the item's mass calculation to account for ports, etc.

\item \texttt{npdiv} is the number of divertor ports, used in the calculation
  of the tritium breeding ratio (\texttt{blktmodel > 0} only).

\item \texttt{nphcdin} and \texttt{nphcdout} are the number of heating/current
  drive ports on the inboard and outboard sides, respectively, used in the
  calculation of the tritium breeding ratio (\texttt{blktmodel > 0}
  only). These may be either `small' (\texttt{hcdportsize = 1}) or `large'
  (\texttt{hcdportsize = 2}).

\item \texttt{wallpf} is the neutron wall load peaking factor (maximum/mean),
  used in the calculation of the blanket lifetime (\texttt{blktmodel > 0}
  only).

\item \texttt{ucblbreed} is the unit cost (\$/kg) of the breeder material
  (\texttt{blktmodel > 0} only).

\end{itemize}

\subsubsection*{Model outputs and available constraints}

The advanced blanket neutronics model provides the following outputs:

\begin{itemize}

\item The total nuclear power deposited in the blanket and shield,
  \texttt{pnucblkt} and \texttt{pnucshld}, respectively, and the energy
  multiplication factor in the blanket, \texttt{emult} are calculated.

\item The tritium breeding ratio, \texttt{tbr}. This can be constrained to be
  no less than a certain value \texttt{tbrmin} for tritium self-sufficiency by
  turning on constraint equation no.\ 52 with iteration variable no.\ 89
  (\texttt{ftbr}). The inboard and outboard blanket BZ thicknesses,
  \texttt{blbuith} and \texttt{blbuoth} can also be used as iteration
  variables (90 and 91, respectively) to help the constraint to be met.

\item The tritium production rate in grammes/day is calculated.

\item The fast neutron fluence (neutrons/m$^2$) on the TF coils is
  calculated. The peak value of this quantity may be constrained to be no more
  than a maximum value \texttt{nflutfmax} by turning on constraint equation
  no.\ 53 with iteration variable no.\ 92 (\texttt{fflutf}). The inboard and
  outboard shield thicknesses, \texttt{shldith} and \texttt{shldoth} can also
  be used as iteration variables (93 and 94, respectively) to help the
  constraint to be met. (Note that in this calculation the TF coil case
  surrounding the superconductor winding pack is ignored.)

\item The nuclear heating power (MW/m$^3$) on the inboard and outboard TF
  coils is calculated. Again, this can be limited to be no more than a maximum
  value \texttt{ptfnucmax} by turning on constraint equation no.\ 54 with
  iteration variable no.\ 95 (\texttt{fptfnuc}). The inboard and outboard
  shield thicknesses also help this constraint to be met.  (Note that in this
  calculation the TF coil case surrounding the superconductor winding pack is
  ignored.) This constraint equation may also be used with \texttt{blktmodel =
    0}.

\item The helium concentration in the vacuum vessel at the end of the plant
  lifetime is calculated. This needs to be constrained for re-weldability
  purposes, and can be kept below a maximum value \texttt{vvhealw} by turning
  on constraint equation no.\ 55 with iteration variable no.\ 96
  (\texttt{fvvhe}).

\item The blanket lifetime is calculated, assuming a maximum allowable level
  of neutron damage to its steel of 60~dpa (currently not adjustable). (For
  the \texttt{blktmodel = 0} model, the allowable blanket fluence
  \texttt{abktflnc} in MW-years/m$^2$ may be input.)

\end{itemize}

\subsubsection{Full thermodynamic blanket model}
\label{sec:blanket}

\Red{Remove asap.}

\textbf{N.B.\ it is recommended that this model is \textit{not}\ used in
  conjunction with the advanced blanket neutronics model (\texttt{blktmodel >
    0}).}

Switch \texttt{lblnkt} determines whether the blanket is to be simulated using
a full thermodynamic model~\cite{Panos} (\texttt{lblnkt = 1}), or simply
assumed to be made up of relevant materials (see
Section~\ref{sec:blanket_materials}) in user-defined proportions. The former
model also performs a self-consistent calculation of the thermal-to-electric
conversion efficiency, whereas the latter simply uses the input value
\texttt{etath}.

The following switches control the details of the full thermodynamic model of
the blanket.

\begin{itemize}

\item \textbf{Cooling channel geometry:} The value of switch \texttt{astr}
  determines whether the cooling channels have a circular cross-section
  (\texttt{astr = 1}) or an annular cross-section (\texttt{astr = 2}). The
  latter case is the default.

\item \textbf{Cooling channel orientation:} The value of switch \texttt{estr}
  determines whether the cooling channels lie in the radial direction
  (\texttt{estr = 1}) or in the poloidal direction (\texttt{estr = 2}). The
  former case is the default.

\item \textbf{Coolant type:} The value of switch \texttt{costr} determines the
  type of coolant used in the first wall, blanket and shield. If \texttt{costr
    = 1}, the coolant is assumed to be gaseous helium. If \texttt{costr = 2},
  the coolant is assumed to be pressurised water/steam, which is the
  default. This switch is used whether or not the full blanket model is used,
  i.e.\ is independent of the setting of switch \texttt{lblnkt}.

\item \textbf{Boundary condition:} The value of switch \texttt{bstr}
  determines whether the coolant output temperature is to be fixed
  (\texttt{bstr = 1}) or whether the maximum blanket temperature is to be
  fixed (\texttt{bstr = 2}). The former case is the default.  The desired
  coolant output temperature for \texttt{bstr = 1} is set using input
  parameter \texttt{xtfo}, and the required maximum blanket temperature is set
  using input parameter \texttt{xtb}.

\end{itemize}

\subsubsection{Blanket materials}
\label{sec:blanket_materials}

Table~\ref{tab:blanket} summarises the possible options for the blanket
materials. Switch \texttt{smstr} determines whether a solid blanket of
Li$_2$O-Be (\texttt{smstr = 1}), or a liquid blanket of LiPb-Li (\texttt{smstr
  = 2}) is used. The former is the default, and is the type assumed if
$\mathtt{lblnkt \not= 1}$.

% Table summarising blanket materials

\begin{table}[tbph]
\begin{center}

\begin{tabular}{||l||c||c||c||} \hline
material & $\mathtt{lblnkt \not= 1}$: & \multicolumn{2}{c||}{\texttt{lblnkt = 1}: full
thermodynamic model} \\ \cline{3-4}
 & simple model & \texttt{smstr=1}: solid blanket & \texttt{smstr=2}: liquid blanket
\\ \hline
stainless steel & \texttt{fblss}   & \texttt{fblss}   & \texttt{fblss}   \\
vanadium        & \texttt{fblvd}   & \texttt{fblvd}   & \texttt{fblvd}   \\
Li$_2$O         & \texttt{fblli2o} & \texttt{fblli2o} &     ---       \\
beryllium       & \texttt{fblbe}   & \texttt{fblbe}   &     ---       \\
LiPb            &     ---       &     ---       & \texttt{fbllipb} \\
lithium         &     ---       &     ---       & \texttt{fblli}   \\
coolant         & \texttt{vfblkt}  & \texttt{vfblkt}  & \texttt{vfblkt}  \\ \hline
\end{tabular}
\end{center}
\caption[Summary of blanket material scenarios]
{\label{tab:blanket}
  \textit{Summary of the materials comprising the blanket in the various scenarios
    available (\texttt{blktmodel=0} only). The fractions given are all
    available to be modified, and should of course add up to 1.0 for any given
    model. The type of coolant used is given by the value of switch \texttt{costr}.} 
}
\end{table}

\subsection{Shield}

The stainless steel shield reduces the neutron flux reaching the TF coils and
beyond. This minimises the radiological impact of the neutrons, and their
heating of the TF coils which, if superconducting, need to remain at liquid
helium temperatures. The shield is cooled either by gaseous helium or by
pressurised water (\textbf{but see Section~\ref{sec:blanket_neutronics}}), as
chosen using switch \texttt{costr} -- see Section~\ref{sec:blanket}, and as
with the blanket the energy deposited in the coolant is used to produce
electricity. The shield coolant fraction is stored in input parameter
\texttt{vfshld}.

The inboard and outboard shield thicknesses (\texttt{shldith} and
\texttt{shldoth}, respectively) may be used as iteration variables.

\subsection{Toroidal field coils}
\label{sec:tfcoil}

The toroidal field (TF) coils can be either resistive or
superconducting. Switch \texttt{itfsup} should be set to \texttt{1} for
superconducting coils, or \texttt{0} for purely copper coils. In the
superconductor model, the \textit{CICC}\/ (Conductor In Cable Conduit)
structure shown in Figure~\ref{fig:CICC} is assumed, and the coils are cooled
using a liquid helium cryogenic system.

The steel radial plates shown in the Figure help in the winding process and
also provide extra support against tangential stresses. Grooves are machined
into the radial plates which act as a guide for the cable. Each winding pack
turn slots into a radial plate and is covered by a steel cap. Each turn is
assigned half the thickness (along each edge) of its surrounding radial plates
and steel caps in the calculation of the cross-sectional areas. Iteration
variable no.\ 101 (\texttt{prp}) is the ratio of the total radial plate plus
steel cap cross-sectional area within the winding pack to the total winding
pack cross-sectional area; from this, the half-thickness \texttt{trp} is
calculated.

The outboard leg of the TF coil is assumed to be the same width in the
toroidal direction as the outside edge of the inboard leg. In the radial
direction, for resistive TF coils the input parameter \texttt{tfootfi} gives
the ratio of the outboard leg thickness to the inboard leg thickness
\texttt{tfcth}; for superconducting coils the outboard thickness is set equal
to the inboard thickness.

\begin{figure}[tbph]
\epsfig{file=tokamak_tfcoil.eps,width=160mm}
\caption[Schematic diagram of the cross-section of a superconducting TF coil
inner leg]
{\label{fig:CICC}
  \textit{Schematic diagram of the cross-section of the inboard leg of a
    superconducting TF coil, showing the CICC (Conductor In Cable Conduit)
    construction. The winding pack contains many turns of cable conduit. The
    cable space contains the superconducting filaments, and circulating liquid
    helium coolant. The variables shown in \Red{red} may be changed by the
    user, and those in italics may be chosen as iteration variables.}
}
\end{figure}

Each TF coil is defined in the $(R,Z)$ plane by four circular arcs of
different radius, which create a D-shaped profile. Because of the finite
number of TF coils used in a tokamak (typically around 16), the toroidal field
has a ripple introduced into it, the amplitude of which can be limited to a
few percent (given by input parameter \texttt{ripmax}, default value 1\%) by
the code by adjusting the outboard gap thickness (labelled \texttt{gapsto} in
Figures~\ref{fig:build_d} and~\ref{fig:build_e}).

Among the TF coil parameters calculated by the code are the maximum allowable
current density, the stresses on the structure, the energy stored and the
magnetic field produced by the coils.

The following options are available within the superconducting TF coil model
(\texttt{itfsup = 1}).

\subsubsection{Superconducting materials}
\label{sec:superconductors}

Switch \texttt{isumattf} specifies which superconducting material is to be
used:
\begin{description}
\item [\texttt{isumattf = 1} :] Nb$_3$Sn superconductor, ITER critical surface
  parameterization~\cite{iter_nb3sn}, standard critical values
\item [\texttt{isumattf = 2} :] Bi-2212 high temperature superconductor %!%!%! ref
\item [\texttt{isumattf = 3} :] NbTi superconductor
\item [\texttt{isumattf = 4} :] Nb$_3$Sn superconductor, ITER critical surface
  parameterization~\cite{iter_nb3sn}, user-defined critical parameters
\end{description}
The fraction of copper present in the superconducting filaments is given by
the value of variable \texttt{fcutfsu} (iteration variable no.\ 59).

For \texttt{isumattf = 2}, a technology adjustment factor \texttt{fhts} may be
used to modify the critical current density fit for the Bi-2212
superconductor, to describe the level of technology assumed (i.e.\ to account
for stress, fatigue, radiation, AC losses, joints or manufacturing variations).
The default value for \texttt{fhts} is 0.5 (a value of 1.0 would be very
optimistic).

For \texttt{isumattf = 4}, important superconductor properties may be input by
the user as follows: the upper critical field at zero temperature and strain
is set using input parameter \texttt{bcritsc}, and the critical temperature at
zero field and strain is set using input parameter \texttt{tcritsc}.

\subsubsection{Current density limits}

The current in the TF coils must be sufficient to produce the required
toroidal field at the centre of the plasma. In tokamaks, the field falls off
at a rate $1/R$, with the peak value occurring at the outer edge of the
inboard portion of the TF coil winding pack ($R_{\mbox{\scriptsize max TF}} =
\mathtt{rbmax}$). The maximum TF coil current depends on the field it produces
and the allowable current density.

\newcommand{\jop}{$J_{\mbox{\scriptsize op}}$ }
\newcommand{\jcrit}{$J_{\mbox{\scriptsize crit}}$}

Three constraints are relevant to the operating current density \jop\ in the
(superconducting) TF coils.

\begin{itemize}

\item To ensure that \jop\ does not exceed the critical value \jcrit, constraint
  equation no.\ 33 should be turned on with iteration variable no.\ 50
  (\texttt{fiooic}).

\item To ensure that \jop\ does not exceed the current density protection limit,
  constraint equation no.\ 35 should be turned on with iteration variable no.\
  53 (\texttt{fjprot}).

\item The critical current density \jcrit\ falls with the temperature of the
  superconductor. The temperature margin $\Delta T$ is the difference between the
  temperature at which \jcrit would be equal to \jop\ and the operating
  temperature. The minimum allowed $\Delta T$ can be set using input parameter
  \texttt{tmargmin} together with constraint equation no.\ 36 and iteration
  variable no.\ 54 (\texttt{ftmargtf}).

  Note that if the temperature margin is positive, \jop\ is guaranteed to be
  lower than \jcrit, and so constraints~33 and~36 need not both be turned on
  (in fact, it is recommended that only one of these two constraints is
  activated in any given run).

\end{itemize}

\subsubsection{Stress model}

Switch \texttt{tfc\_model} controls whether a simple stress model
(\texttt{tfc\_model = 0}, suitable for solid copper TF coils) or a more
complex stress model (\texttt{tfc\_model = 1}) should be used. If
\texttt{tfc\_model = 1}, a two-layer stress model~\cite{Morris_tfc} developed
by CCFE is used.

To enforce the stress limits calculated using either of these models,
constraint equation no.\ 31 (case stress) and/or constraint equation no.\ 32
(conduit stress) should be turned on with iteration variables no.\ 48
(\texttt{fstrcase}) and/or no.\ 49 (\texttt{fstrcond}), respectively. The
stress limit can be adjusted using input parameters \texttt{csutf} and
\texttt{csytf}.

\subsection{Poloidal field coils}
\label{sec:pfcoils}

The poloidal field (PF) coils are used initially to cancel the vertical field
produced at the centre of the plasma by the central solenoid (Section~\ref{sec:ohcoil})
during start-up, and then to maintain the plasma position and shape during the
flat-top period.

\subsubsection{PF coil positions}

The positions and sizes of the PF coils are partly input, and partly
calculated after consideration of the required currents and allowable current
density.

The PF coil locations are controlled using a set of switches stored in array
\texttt{ipfloc} (see Figure~\ref{fig:build_d}), and are calculated in routine
\texttt{PFCOIL}. The coils are (usually) organised into groups containing two
PF coils placed symmetrically above and below the midplane, and each group
\texttt{j} has an element \texttt{ipfloc(j)} assigned to it. Input parameter
\texttt{ngrp} should be set to the number of groups, and \texttt{ncls(j)}
should be assigned the number of coils in each group --- which should be
\texttt{2} in each case.

In the following, all variables are defined in the variable descriptor file
\texttt{vardes.html}. The values for \texttt{rpf1}, \texttt{rpf2},
\texttt{zref(j)} and \texttt{routr} should be adjusted by the user to locate
the PF coils accurately.

The three possible values of \texttt{ipfloc(j)} correspond to the following PF
coil positions: (\Red{Redo taking into account snull and other recent changes
  e.g. rclsnorm})

\begin{description} %!%!%! check this

\item [\texttt{ipfloc(j) = 1} :]  PF coils are placed above the central solenoid (one
group only);
\begin{eqnarray*}
R & = & \mathtt{rohc + rpf1} \\
Z & = & \pm
\mathtt{( hmax*ohhghf + 0.1 + 0.5*( hmax*(1.0D0-ohhghf)+tfcth+0.1) )}
\end{eqnarray*}

\item [\texttt{ipfloc(j) = 2} :]  PF coils are placed above the TF coils (one
group only);
\begin{eqnarray*}
R & = & \mathtt{rmajor + rpf2*triang*rminor} \hspace{62mm} \\
Z & = & \pm (\mathtt{hmax + tfcth + 0.86})
\end{eqnarray*}

\item [\texttt{ipfloc(j) = 3} :]  PF coils are placed radially outside the TF
coils (any number of groups \Red{(?)});
\begin{eqnarray*}
R & = & \mathtt{rtot + tfthko/2.0D0 + routr} \hspace{63mm}\\
Z & = & \pm(\mathtt{rminor*zref(j)})
\end{eqnarray*}

\end{description}

The void fraction (for coolant) in each coil \texttt{i}'s winding pack is
given by \texttt{vf(i)}.

\subsubsection{PF coil currents}

The peak current per turn, \texttt{cptdin(i)}, and the winding pack peak
current density \texttt{rjconpf(i)} in each PF coil \texttt{i} are inputs. The
PF coil currents vary as a function of time during the tokamak operation as
indicated in Figure~\ref{fig:current_vs_time}. They contribute part of the
flux swing necessary to maintain the plasma current (see
Section~\ref{sec:ohcoil}).

\begin{figure}[tbph]
\epsfig{file=current_vs_time.eps,width=170mm}
\caption[Coil and plasma current waveforms]
{\label{fig:current_vs_time}
  \textit{Plot showing schematically the current waveforms for the plasma, a
    typical PF coil, and the central solenoid. Note that the currents in some
    of the PF coils may be the opposite sign to that shown, and the central
    solenoid current may remain positive during the $I_p$ ramp-up period,
    although it will pass through zero during the burn phase.}
}
\end{figure}

\subsubsection{PF coil resistance}

The PF coils can be either resistive or superconducting. This is determined
from the value of \texttt{ipfres}. If \texttt{ipfres = 0}, the PF coils and
the central solenoid are assumed to be superconducting. If \texttt{ipfres = 1},
they are assumed to be resistive, with their resistivity given by the value of
variable \texttt{pfclres}.

\subsubsection{Superconducting materials}

If \texttt{ipfres = 0}, switch \texttt{isumatpf} specifies which
superconducting material is to be used for the PF coils. The values for
\texttt{isumatpf} are used in the same way as switch \texttt{isumattf} is for
the TF coils (see Section~\ref{sec:superconductors}).

The fraction of copper present in the superconducting filaments is given by
the value of variable \texttt{fcupfsu}.

If the PF coils are superconducting, a steel case is assumed to surround the
current-carrying winding pack to take the hoop stress. Its cross-sectional
area is determined by the $J \times B$ hoop force on the coil divided by the
allowable hoop stress, given by input parameter \texttt{sigpfcalw}. The input
parameter \texttt{sigpfcf} provides a scale factor (default is 0.666) to
adjust the hoop force if required, to indicate what proportion of the force is
supported by the case.

\subsection{Central solenoid}
\label{sec:ohcoil}

Formerly known as the ohmic heating (OH) coil, the central solenoid is a PF
coil used primarily during start-up (but also during the burn phase) to create
and maintain the plasma current by inductive means. Swinging (changing) the
current through the central solenoid causes a change in the flux linked to the
plasma region, inducing a current in it. \process\ calculates the amount of
flux required to produce the plasma current, and also the amount actually
available. The code measures the magnetic flux in units of Volt-seconds ($=$
Webers).

Switch \texttt{iohcl} controls whether a central solenoid is present. A value
of \texttt{1} denotes that this coil is present, and should be assigned a
non-zero thickness \texttt{ohcth}. A value of \texttt{iohcl = 0} denotes that
no central solenoid is present, in which case the thickness \texttt{ohcth}
should be set to zero. No PF coils should be located at positions defined by
\texttt{ipfloc(j) = 1} if no central solenoid is present.

The central solenoid can be either resistive or superconducting (controlled
via switch \texttt{ipfres} as for the other PF coils), and if superconducting,
switch \texttt{isumatoh} determines the superconducting material to use ---
its value is used like \texttt{isumattf} and \texttt{isumatpf}. The fraction
of copper present in the superconducting filaments is given by the value of
variable \texttt{fcuohsu}.

If the central solenoid is superconducting, the coil contains steel for
strength. The cross-sectional area of steel is determined by the $J \times B$
hoop force on the coil divided by the allowable hoop stress, calculated as the
lower of the two quantities (2/3 * \texttt{csytf}) and (0.5 * \texttt{csutf}),
where input parameter \texttt{csytf} (Pa) is the yield strength of the steel,
and \texttt{csutf} (Pa) is the ultimate strength of the steel. (This is the
same calculation as for the allowable stress in the TF coil cases.) A steel
thickness is given in the output, which would be the thickness of a
steel case of the same cross-sectional area if it simply surrounded the
conducting region.

\subsubsection{Current density inputs and limits}

The (absolute value of the) central solenoid current density at the
end-of-flat-top (`EOF'), \texttt{coheof} is specified by the user, and can be
used as an iteration variable (no.\ 37). The current density at the
beginning-of-pulse (`BOP' --- see Figure~\ref{fig:current_vs_time}) is
specified as a (positive) fraction of \texttt{coheof} using \texttt{fcohbop}
(iteration variable no.\ 41). The current density in the CS at all other times
is calculated by taking account of the flux swing necessary to initiate and
maintain the plasma current. The positive or negative sign of the current at
each time is calculated automatically.

The current density in the central solenoid can be limited at the BOP and at
the EOF. To limit the current density at the BOP, constraint equation no.\ 27
should be turned on with iteration variable no.\ 39 (\texttt{fjohc0}). To
limit the current density at the EOF, constraint equation no.\ 26 should be
turned on with iteration variable no.\ 38 (\texttt{fjohc}).

As for the TF coils, the critical current density \jcrit\ falls with the
temperature of the superconductor. The temperature margin $\Delta T$ is the
difference between the temperature at which \jcrit would be equal to \jop\ and
the operating temperature. The minimum allowed $\Delta T$ can be set using
input parameter \texttt{tmargmin} together with constraint equation no.\ 60
and iteration variable no.\ 106 (\texttt{ftmargoh}).

Note that if the temperature margin is positive, \jop\ is guaranteed to be
lower than \jcrit, and so constraints~26, 27 and~60 need not all be turned on
(in fact, it is recommended that EITHER the latter constraint, OR the former
two constraints, is/are activated in any given run).

\subsubsection{Plasma current ramp-up time}
\label{sec:tohs}

In the steady-state power plant scenario ($\mathtt{lpulse \not= 1}$ --- see
Section~\ref{sec:pulsed}), the length of time taken for the central solenoid
current to (possibly) reverse (which is equal to the plasma current ramp-up time --- see
Figure~\ref{fig:current_vs_time}) is determined from the value of switch
\texttt{tohsin}. If \texttt{tohsin = 0.0D0}, then the plasma current ramp-up
time \texttt{tohs} in seconds is given by $\mathtt{tohs} = I_p / 0.5$, where
$I_p$ is the plasma current in MA\@. Furthermore, the PF coil ramp time
\texttt{tramp} and shutdown time \texttt{tqnch} are set equal to
\texttt{tohs}.  If $\mathtt{tohsin \not= 0.0D0}$, the plasma current ramp-up
time \texttt{tohs = tohsin}, and the PF coil ramp and shutdown times are input
parameters.

If, however, a pulsed power plant is being modelled (\texttt{lpulse = 1}), the
plasma current ramp-up time \texttt{tohs} is either an input parameter, or it can be
iterated by using iteration variable~65. The ramp and shutdown times in the
pulsed case are always set equal to \texttt{tohs}. To ensure that the plasma
current ramp rate during start-up is prevented from being too high, as
governed by the requirement to maintain plasma stability in $l_i$-$q_\psi$
space, constraint equation no.\ 41 should be turned on with iteration variable
no.\ 66 (\texttt{ftohs}).

\subsection{Auxiliary power systems: heating and current drive}
\label{sec:hcd}

\subsubsection{Current Drive}

The use of purely inductive current drive leads to pulsed plant operation
because of the limited flux swing that can be achieved using the central
solenoid. This poses problems due to the fact that fatigue failures may
result, and there would also be a need for thermal storage to maintain a level
supply between pulses. However, the plasma current can also be produced and
maintained (partially or wholly) using non-inductive means which, in
principle, removes this restriction. \process\ contains a number of auxiliary
current drive schemes, including various RF methods (Lower Hybrid, Electron
Cyclotron, and Ion Cyclotron (Fast Wave) current drives) and also Neutral Beam
current drive systems. The code calculates the efficiency and the resulting
power requirements of the chosen system.

The fraction of the required plasma current to be produced by non-inductive
means, \texttt{fvsbrnni}, should be set, and flag \texttt{irfcd} should be set
to \texttt{0} for purely inductive scenarios, or \texttt{1} otherwise. The
current drive efficiency model to be used in this latter case is defined by
the value of switch \texttt{iefrf}:-

\begin{description}
\item [\texttt{iefrf = 1} :] Fenstermacher Lower Hybrid model
\item [\texttt{iefrf = 2} :] Ion cyclotron model~\cite{IPDG}
\item [\texttt{iefrf = 3} :] Fenstermacher electron cyclotron resonance model
\item [\texttt{iefrf = 4} :] Ehst Lower Hybrid model
\item [\texttt{iefrf = 5} :] ITER neutral beam model~\cite{IPDG,172}
\item [\texttt{iefrf = 6} :] Culham Lower Hybrid model~\cite{172}
\item [\texttt{iefrf = 7} :] Culham electron cyclotron model~\cite{172}
\item [\texttt{iefrf = 8} :] Culham neutral beam model~\cite{172}
\item [\texttt{iefrf = 9} :] Oscillating Field current drive (RFPs only --- see
Section~\ref{sec:rfpcd})
\end{description}

(Note that, at present, the neutral beam models assume parabolic plasma
profiles only.)

It is sometimes useful to adjust artificially the current drive efficiency
values produced by these routines. This can be achieved by setting the scaling
coefficient \texttt{feffcd}. The wall plug to plasma efficiencies can also be
adjusted, by changing the relevant variable (\texttt{etaech}, \texttt{etalh},
\texttt{etanbi} or \texttt{etaof}).

\subsubsection{Plasma heating}

In addition to current drive, some auxiliary power can be used purely to heat
the plasma. The value of input parameter \texttt{pheat} determines the amount
of auxiliary \textit{heating}\/ power (in Watts) to be applied to the
plasma. This variable may be used as an iteration variable (no.\ 11).

\subsubsection{Neutral beam access}

If present, a neutral beam injection system needs sufficient space between the
TF coils to be able to intercept the plasma tangentially. The major radius
\texttt{rtanbeam} at which the centreline of the beam is tangential to the
toroidal direction is user-defined using input parameter \texttt{frbeam},
which is the ratio of \texttt{rtanbeam} to the plasma major radius
\texttt{rmajor}. The maximum possible tangency radius \texttt{rtanmax} is
determined by the geometry of the TF coils --- see Figure~\ref{fig:portsize},
and this can be enforced using constraint equation no.\ 20 with iteration
variable no.\ 33 (\texttt{fportsz}). The thickness of the beam duct walls may
be set using input parameter \texttt{nbshield}.

\begin{figure}[tbph]
\epsfig{file=portsize.eps,width=160mm}
\caption[Schematic diagram of the neutral beam access geometry]
{\label{fig:portsize}
  \textit{Top-down schematic view of the neutral beam access geometry. The beam
    with the maximum possible tangency radius is shown here.}
}
\end{figure}

\subsubsection{Neutral beam losses}

Input parameter \texttt{forbitloss} can be used to specify the fraction of the
net injected neutral beam power that is lost between the beam particles'
ionisation and thermalisation (i.e.\ the orbit loss fraction). The power lost
is assumed to be absorbed by the first wall.

There are two constraint equations that can be used to control the beam
penetration and deposition, as follows:

\begin{itemize}

\item It is necessary to use a beam energy that simultaneously gives adequate
  penetration of the beam to the centre of the plasma and tolerable
  shine-through of the beam on the wall after the beam has traversed the
  plasma. The number of exponential decay lengths, $\tau$, for the beam power
  to fall before it reaches the plasma centre should be in the region of $\sim
  4$--6~\cite[Section 4.3.2]{172}. Constraint equation no.\ 14 may be used to
  force $\tau$ to be equal to the value given by input parameter
  \texttt{tbeamin}, and is therefore in effect a beam energy consistency
  equation.

\item Alternatively, constraint equation no.\ 59 with iteration variable no.\
  105 (\texttt{fnbshinef}) may be used to ensure that the beam power fraction
  emerging from the plasma is no more than the value given by input parameter
  \texttt{nbshinefmax}.

\end{itemize}

It is recommended that \textbf{only one} of these two constraint equations is
used during a run.

\subsubsection{Ignited plasma}
\label{sec:ignited}

Switch \texttt{ignite} can be used to denote whether the plasma is ignited,
i.e.\ fully self-sustaining without the need for any injected auxiliary power
during the burn. If \texttt{ignite = 1}, the calculated injected power does
not contribute to the plasma power balance (Section~\ref{sec:corepower}),
although the cost of the auxiliary power system is taken into account (the
system is then assumed to be required to provide heating etc.\ during the
plasma start-up phase only --- use \texttt{pheat} to indicate the power
requirement). If \texttt{ignite = 0}, the plasma is not ignited, and the
auxiliary power is taken into account in the plasma power balance during the
burn phase. Also, constraint equation no.\ 28 can be turned on to enforce the
fusion gain $Q$ to be at least \texttt{bigqmin}.

\subsection{Structural components}

Structural components are required to provide support for the fusion power
core systems against gravity and the magnetic forces that will be encountered
during operation. The required structural masses and their costs are
calculated.

\subsection{Cryostat and vacuum system}

The internal vacuum vessel provides a toroidal evacuated chamber containing
the plasma, first wall, blanket and shield, and the space between this item
and the external cylindrical cryostat encloses those components that need to
operate at liquid helium temperatures. These include any superconducting (TF
or PF) coils and the inter-coil structure. \process\ calculates the cryogenic
power load and the resulting heat exchanger requirements.

The vertical distance \textit{h}\/ between the uppermost PF coil and the
external cryostat lid may be adjusted by changing the value of input parameter
\texttt{clhsf}; a scaling based on ITER is used:
\begin{equation}
h = \mathtt{clhsf} \, \left( \frac{2 \times \mathtt{rdewex}}{28.440} \right)
\end{equation}

The vacuum system is used for four different processes. Firstly, before plasma
operations the chamber must be evacuated to remove outgassed impurities from
the structure. Secondly, the chamber must be re-evacuated between burn
operations. Thirdly, helium ash must be removed to prevent it from diluting
the fuel. Finally, deuterium and tritium is removed on a steady state
basis. \process\ calculates the parameters of a vacuum system that satisfy
all four requirements, with the option of either turbo pumps or cryo pumps
being used.

Switch \texttt{ntype} controls whether a turbopump (\texttt{ntype = 0}) or a
cryopump (\texttt{ntype = 1}) is used in the vacuum system.

\subsection{Power conversion and heat dissipation systems}
\label{sec:powerflow}

The \process\ power plant takes into account all the systems required to
perform the necessary conversion of fusion power to electricity, from the
coolant systems in the plant components to the heat exchangers and turbines.
%Figure~\ref{fig:pwrconv} shows schematically the overall power transfer
%mechanisms used by the code.
%
%\begin{figure}[tbph]
%\centerline{\epsfig{file=PWR.ps,width=160mm,height=160mm,
%bbllx=0mm,bburx=200mm,bblly=0mm,bbury=200mm,clip=}}
%\vspace{-12mm}
%\caption[Power conversion mechanisms within \process]
%{\label{fig:pwrconv}
%  \textit{Schematic diagram showing the power conversion mechanisms used in
%    \process \cite[Note 0166]{PWF}.}
%}
%\end{figure}
%
%Many of the power conversion efficiencies shown in Figure~\ref{fig:pwrconv}
%can be adjusted by the user.

Figures~\ref{fig:powerflow2} and \ref{fig:powerflow3} show schematically the
overall power transfer mechanisms within the power plant outside of the plasma
(the power flow \textit{within}\/ the plasma is shown in
Figure~\ref{fig:powerflow1}).

(Note that these figures and the following description assume that switch
\texttt{ipowerflow} is set to 1; its default value is currently
zero, as the new power flow model is in draft form.)

\begin{figure}[tbph]
\epsfig{file=powerflow2.eps,width=170mm}
\caption[Power flow within the fusion power plant core]
{\label{fig:powerflow2} \textit{Schematic diagram of the flow of power from
    the plasma to the thermal power deposited within the divertor, first wall,
    blanket and shield. Variable names are given in [\ldots]. The three
    red-bordered contributions are passed from Figure~\ref{fig:powerflow1},
    while the blue box comes from Figure~\ref{fig:powerflow3}.} }
\end{figure}

Figure~\ref{fig:powerflow2} shows how the power contributions originating from
the plasma are converted to thermal power in the first wall, blanket, shield
and divertor.

The radiation and neutron power contributions are distributed according to the
following area fractions of a theoretical first wall with 100\% coverage,
which may be set as input parameters: \texttt{fdiv} (divertor area fraction),
\texttt{fhcd} (heating / current drive / diagnostics apparatus), and
\texttt{fhole} (any other gaps). The remaining fraction
(\texttt{1-fdiv-fhcd-fhole}) is the area fraction of the actual first wall.

\subsubsection{Divertor}

All of the charged particle transport power leaving the plasma is assumed to
be absorbed in the divertor, along with a proportion \texttt{fdiv} of the
radiation power and the neutron power. The power necessary to drive the
divertor coolant pumps $P$ (= \texttt{htpmw\_div} in
Figure~\ref{fig:powerflow2}) is assumed to be a fraction $f$ (= input
parameter \texttt{fpumpdiv}) of the total thermal power absorbed by the
divertor, which includes the coolant pump power itself:
\begin{eqnarray*}
P & = & f . (\mathtt{pdivt} + \mathtt{praddiv} + \mathtt{pnucdiv} + P) \\
\Longrightarrow P & = & \frac{f}{1-f} . (\mathtt{pdivt} + \mathtt{praddiv} +
\mathtt{pnucdiv})
\end{eqnarray*}
The efficiency of the divertor coolant pump is given by input parameter
\texttt{etahtpdiv}.

Switch \texttt{iprimdiv} may be used to specify whether the thermal power
deposited in the divertor becomes primary (high-grade) thermal power
(\texttt{iprimdiv = 1}) or secondary (low-grade) thermal power (see
Figure~\ref{fig:powerflow3}).

\subsubsection{First wall}

All of the remaining radiation power (i.e.\ the fraction not incident upon the
divertor or lost through holes or the heating / current drive apparatus) is
assumed to be absorbed by the first wall. The same fraction of the neutron
power is assumed to pass into the first wall. Of this neutron power, a
fraction $(1-e^{\lambda/d})$ is assumed to be absorbed in the first wall
(of thickness $d$), given by the neutron decay length $\lambda$ in the first wall
(input parameter \texttt{declfw}).

As for the divertor, the first wall coolant pump power is a fraction
\texttt{fpumpfw} of the total thermal power absorbed by the first wall, and
the efficiency of the first wall coolant pump is \texttt{etahtpfw}.

\subsubsection{Blanket}

A fraction (\texttt{1 - exp(declblkt/blnkoth)}) of the neutron power incident
on the blanket is assumed to be absorbed in the blanket, where input parameter
\texttt{declblkt} is the neutron decay length in the blanket. This absorbed
neutron power is multiplied by the energy multiplication factor \texttt{emult}
to calculate its contribution to the thermal power within the blanket.

As for the other components, the blanket coolant pump power is a fraction
\texttt{fpumpblkt} of the total thermal power absorbed by the blanket, and
the efficiency of the blanket coolant pump is \texttt{etahtpblkt}.

\subsubsection{Shield}

A fraction (\texttt{1 - exp(declshld/shldoth)}) of the neutron power incident
on the shield is assumed to be absorbed in the shield, where input parameter
\texttt{declshld} is the neutron decay length in the shield.

As for the other components, the shield coolant pump power is a fraction
\texttt{fpumpshld} of the total thermal power absorbed by the shield, and
the efficiency of the shield coolant pump is \texttt{etahtpshld}.

Switch \texttt{iprimshld} may be used to specify whether the thermal power
deposited in the shield becomes primary (high-grade) thermal power
(\texttt{iprimshld = 1}) or secondary (low-grade) thermal power (see
Figure~\ref{fig:powerflow3}).

The remaining neutron power after passing through the shield is assumed to be
absorbed in the TF coils as quantity \texttt{ptfnuc}. This power contributes
to the total cryogenic power requirements of the machine.

\subsubsection{Power conversion outside of the fusion power core}

Figure~\ref{fig:powerflow3} summarises the power conversion mechanisms outside
of the fusion power core.

\begin{figure}[tbph]
\epsfig{file=powerflow3.eps,width=170mm}
\caption[Power flow outside the fusion power plant core]
{\label{fig:powerflow3} \textit{Schematic diagram of the flow of power beyond
    the fusion power core, showing the origin of the primary and secondary
    thermal power and the electrical power balance within the plant. Variable
    names are given in [\ldots]. The input power contributions in green boxes
    originate in Figure~\ref{fig:powerflow2}. }  }
\end{figure}

The primary (high-grade, i.e.\ useable) thermal power comprises the thermal
power contributions from the first wall and blanket, and possibly also those
from the divertor and shield, depending on the values of the switches
\texttt{iprimdiv} and \texttt{iprimshld} as described in the previous
sections. The primary thermal power (less any thermal power required to
produce hydrogen in a hydrogen production plant --- see
Section~\ref{sec:hplant}) is used to produce steam to turn the turbines, thus
generating the plant's gross electrical power, with an efficiency given by
input parameter \texttt{etath}. The power lost via the turbines' inefficiency
escapes from the plant to the environment.

The electrical power required to operate the power plant itself is the
so-called recirculating electric power. Any surplus is exported to the
electricity grid as net electric power.

The recirculating power comprises the electrical power required to run all of
the associated electrical systems surrounding the fusion power core, plus the
on-site building services, offices, etc., as shown in
Figure~\ref{fig:powerflow3}. Of these, the cryogenic plant power includes the
power required to cool the TF coils from the neutron power absorbed by the
coils, the PF coils (as defined by the ratio of the total PF coil stored
energy to the fusion power pulse time \texttt{tpulse}), and other `cold'
components.

\subsection{Buildings}

The volume and ground area of all the various buildings on a power plant site
are included in the \process\ calculations for the benefit of the costing
algorithms. %!%!%! expand

\section{Spherical Tokamak Model}
\label{sec:tart}

\process\ has the ability to perform studies on tokamaks in the low aspect ratio
regime (major radius $\leq 2 \times$ minor radius). The physics and
engineering issues~\cite{tart} associated with these machines are somewhat
different from those of conventional aspect ratio, and this is reflected by
the following special models~\cite{storac} in \process.

\begin{enumerate}

\item The inboard build of a spherical tokamak (ST) is very different from
  that in a conventional tokamak. There is no inboard blanket (and possibly no
  inboard shield), and the inboard TF coil legs are replaced by a single
  centrepost. The radial build is altered so that, starting from the
  centreline ($R = 0$), the component order is: TF coil, gap, central
  solenoid, vacuum vessel, and then continuing as in Figure~\ref{fig:build_d}
  (a D-shaped cross-section is assumed for the first wall, blanket, shield and
  vacuum vessel).

\item Spherical tokamaks have resistive TF coils that combine into a single
  centrepost at the centre of the machine. The centrepost is constructed from
  copper (as are the outboard TF coil sections), and is tapered lengthways so
  that it is narrowest at the midplane of the device.  Routine
  \texttt{CNTRPST} calculates various parameters relevant to the centrepost,
  including the pump pressure, maximum temperature and pipe radius, and these
  may be limited using constraint equations~43 to~46 if required:

  \begin{itemize}
  \item Equation~43 is a consistency equation for the average centrepost
    temperature.
  \item Equation~44 can be used to limit the peak centrepost temperature to a
    maximum value (\texttt{ptempalw}) using iteration variable no.\ 68
    (\texttt{fptemp}).
  \item Equation~45 can be used to force a lower limit to the edge safety
    factor $q_{lim}$ (see below), using iteration variable no.\ 71 (\texttt{fq}).
  \item Equation~46 can be used to apply an upper limit to the ratio of plasma
    current to TF coil (``rod'') current, using iteration variable no.\ 72
    (\texttt{fipir}).
  \end{itemize}

\item A gaseous divertor model is used, and a simple divertor heat load
  calculation is employed, rather than the more complex divertor model assumed
  for conventional aspect ratio tokamaks.

\item A simple PF coil current scaling algorithm is available for use with the
  ST option.

\item The plasma shaping terms (elongation and triangularity) can be
  calculated directly given the aspect ratio, using \texttt{ishape = 1} (see
  Section~\ref{sec:plasma_geometry}). This setting also scales the lower
  limit~\cite{storac} for the edge safety factor, for use with constraint
  equation no.\ 45:
  \begin{equation}
    q_{lim} = 3 \, (1 + 2.6*\epsilon^{2.8})
  \end{equation}
  where $\epsilon = a/R$. 

\item Among the physics models that differ from those relevant to conventional
  aspect ratio machines are (i) the plasma poloidal field $B_{pol}$, (ii) the
  bootstrap current fraction, (iii) the beta limit, and (iv) the neutron
  heating of the centrepost~\cite{storac}.

\end{enumerate}

\subsection{Spherical tokamak switches}

Switch \texttt{itart} provides overall control of the ST switches within the
code, and subroutine \texttt{CHECK} ensures that no conflicting values are
inadvertently set by the user in the input file. Table~\ref{tab:tart}
summarises the switch values relevant to each aspect ratio regime.
\begin{table}[tbph]
\begin{center}
  \begin{tabular}{||l|c|c||} \hline
    & conventional aspect ratio & low aspect ratio \\
    switch & \texttt{itart = 0} & \texttt{itart = 1} \\ \hline
    \texttt{ishape} & 0, 2 & 0, 1 \\
    \texttt{ibss} (Section~\ref{sec:bootstrap}) & 1, 2, 3 & 2, 3 \\
    \texttt{icurr} (Section~\ref{sec:current_scaling}) & 1, 3, 4, 5, 6, 7 & 2 \\
    \texttt{itfsup} (Section~\ref{sec:tfcoil}) & 0, 1 & 0 \\
    \hline
\end{tabular}
\end{center}
\caption[\process\ switches for spherical tokamaks]
{\label{tab:tart}
  \textit{Summary of the switch values in PROCESS that relate to
    conventional aspect ratio and low aspect ratio machines.}
}
\end{table}

\section{Pulsed Plant Operation}
\label{sec:pulsed}

If the plasma current is not to be driven by purely non-inductive means, it is
necessary to operate the plant in a pulsed manner as the current swing in the
OH/PF coils cannot be continued indefinitely. \process\ can perform a number of
calculations relevant to a pulsed power plant, as detailed below.

Switch \texttt{lpulse} determines whether the power plant is assumed to be
based on steady-state (\texttt{lpulse = 0}) or pulsed (\texttt{lpulse = 1})
operation.

\subsection{Thermal cycling package}

This performs calculations on the first wall of the machine. Evaluation of the
mechanical and thermal stresses on this component lead to a measure of the
maximum number of cycles to which the first wall can be subjected, and hence
to the minimum allowable length of each reactor cycle for a specified first
wall lifetime. The cycle time can be constrained to be at least the minimum
value by turning on constraint equation no.\ 42 with iteration variable no.\
67 (\texttt{ftcycl}).

The thickness of the first wall is constrained to lie within lower and upper
bounds, which ensures that it can withstand the internal coolant pressure and
the peak temperature and neutron fluence.

Switch \texttt{itcycl} activates the desired model for the first wall axial
stress calculations. If \texttt{itcycl = 1} (the default), the wall is fully
constrained axially, and no bending can occur. If \texttt{itcycl = 2}, there
is no constraint on the axial motion, but no bending can occur. Finally, if
\texttt{itcycl = 3}, again there is no axial constraint, and bending is
allowed to occur.

\subsection{First wall coolant temperature rise limit}

The rise in temperature of the first wall coolant can be limited to be no more
than the value of \texttt{dtmpmx} by turning on constraint equation no.\ 38 with
iteration variable no.\ 62 (\texttt{fdtmp}).

\subsection{First wall peak temperature limit}

The maximum first wall temperature can be limited to be no more than the value
of variable \texttt{tpkmax} by turning on constraint equation no.\ 39 with
iteration variable no.\ 63 (\texttt{ftpeak}).

\subsection{Start-up power requirements}

The minimum auxiliary power required during the start-up (ignition) phase is
calculated on the basis of a POPCON analysis. Ignition is accessed via the
so-called Cordey Pass (the path in plasma density--temperature space which
minimises the power requirement) and the code ensures that there is sufficient
auxiliary power to accommodate this. In fact, this calculation is very
CPU-intensive, so the relevant routine is not called at present. In practice,
the auxiliary power tends to exceed the minimum allowable value anyway,
without any need to constrain it to do so.

The auxiliary power reaching the plasma can be forced to be more than the
minimum allowable value \texttt{auxmin} by turning on constraint equation no.\
40 with iteration variable no.\ 64 (\texttt{fauxmn}). The value of
\texttt{auxmin} is determined by the code if the start-up model is activated,
otherwise it may be initialised via the input file.

\subsection{Plasma current ramp-up time}

This calculation ensures that the plasma current ramp rate during start-up is
prevented from being too high, as governed by the requirement to maintain
plasma stability in $l_i$ - $q_\psi$ space (see Section~\ref{sec:tohs}).

\subsection{Burn time}

The length of the burn time is calculated from the surplus volt-seconds
available from the OH/PF coil system during the plasma burn phase, after the
flux required during the plasma start-up is taken into account. A minimum burn
time can be enforced via constraint equation no.\ 13 and iteration variable
no.\ 21 (\texttt{ftburn}).

\subsection{Thermal storage}

During every cycle there is a period when no fusion power is produced. The net
electric output from the plant must, however, be maintained, and this is
achieved using thermal storage. There are three types of thermal storage
available within \process, and the value of switch \texttt{istore} determines
which is to be used. If \texttt{istore = 1} (the default), option~1 of
Ref.~\cite{ELECTROWATT} is assumed, which utilises the thermal storage
inherent in the machine's steam cycle equipment. This should be used if the
machine down time is less than 100~seconds. If \texttt{istore = 2}, option~2
of Ref.~\cite{ELECTROWATT} is assumed, which uses the same method as before,
but augments it with an additional boiler. This may be used for machine down
times of up to 300~seconds. Finally, if \texttt{istore = 3}, a large stainless
steel block acts as the thermal storage medium.

\section{Hydrogen Production Facility}
\label{sec:hplant}

Fusion power plants have been mooted as a means of producing hydrogen for use
in fuel cells for cars, for instance. \process\ includes options to enable
the plant to produce hydrogen using a number of different processes.

To include the production of hydrogen by the power plant, it is necessary to
set the switch \texttt{ihplant}, as follows:
\begin{description}
\item [\texttt{ihplant = 0} :] No hydrogen production (default)
\item [\texttt{ihplant = 1} :] Hydrogen production by low temperature electrolysis
\item [\texttt{ihplant = 2} :] Hydrogen production by endothermic high
  temperature electrolysis
\item [\texttt{ihplant = 3} :] Hydrogen production by exothermic high
  temperature electrolysis
\item [\texttt{ihplant = 4} :] Hydrogen production by thermo-chemical processes
\end{description}
Table~\ref{tab:hplant} describes the additional options available for each of
the types of hydrogen production given above. The different processes use
either electrical power or thermal power directly, so the required inputs
differ. Variable \texttt{helecmw} (iteration variable no.\ 87) is the
electrical power in MW required for hydrogen production, while
\texttt{hthermmw} (iteration variable no.\ 88) is the thermal power
required. Note that \texttt{hthermmw} must not be used as an iteration
variable if $\mathtt{ihplant \not= 4}$, as it will be calculated from the
required electrical power instead. Similarly, \texttt{helecmw} must not be
used as an iteration variable if \texttt{ihplant = 4}.
\begin{table}[tbph]
\begin{center}
\begin{tabular}{||c|c|c|c||} \hline
hydrogen plant option & \texttt{helecmw} & \texttt{hthermmw} & efficiency
variable \\ \hline
\texttt{ihplant=1} & input & zero & \texttt{etahlte} \\
\texttt{ihplant=2} & input & calculated & \texttt{etahten} \\
\texttt{ihplant=3} & input & calculated & \texttt{etahtex} \\
\texttt{ihplant=4} & zero & input & \texttt{etahth} \\
\hline
\end{tabular}
\end{center}
\caption[Variables used in the hydrogen plant model]
{\label{tab:hplant}
  \textit{Summary of the variables in PROCESS that relate to
    the different hydrogen plant processes.}
}
\end{table}
The efficiency variables given in Table~\ref{tab:hplant} are all input
parameters, and are the factors to be used to convert the value of
\texttt{helecmw} to the amount of hydrogen produced (in MW equivalent); these
can be greater than unity in all cases except \texttt{ihplant = 4}.

\section{Stellarator Model}

The code has the ability to perform calculations based on the physics and
engineering of a stellarator, which, although being a toroidal device, is
radically different in a number of ways from a tokamak.

The model is largely based on W7-X and the HELIAS 5-B stellarator power plant
design~\cite{helias5b} (Figure~\ref{fig:helias5b}) and related modelling that
has been performed by IPP Greifswald~\cite{stell_geometry, stell_divertor,
  stell_coil}.

To activate the stellarator coding, it is necessary to create a file
\texttt{device.dat}, containing the single character \texttt{1} in the first
row, in the working directory (see Section~\ref{sec:infile}). This has the
effect of setting the internally-used switch \texttt{istell = 1}. If the file
is absent, or its first character is set to something other than \texttt{1},
the stellarator model is not used, and \texttt{istell} is set to
\texttt{0}.

The stellarator model is largely contained within source file
\texttt{stellarator.f90}. The following consistency equations (see
Section~\ref{sec:constraints}) should be used without modification:

\begin{description}
\item [\texttt{1} :] plasma beta consistency
\item [\texttt{2} :] global power balance
\item [\texttt{11} :] radial build consistency
\end{description}

\begin{figure}[tbph]
\centerline{\epsfig{file=helias5b.eps,width=160mm}}
\caption[HELIAS 5-B Stellarator Power Plant Design]
{\label{fig:helias5b}
  \textit{Fusion power core of the HELIAS 5-B conceptual power plant design
    (from~\cite{helias5b})}
}
\end{figure}

\subsection{Stellarator physics}

Much of the physics is identical to that for tokamaks, including the plasma
composition and the fusion power calculations. However, some physics topics do
differ between stellarators and tokamaks, as follows.

\subsubsection{Plasma geometry}

The plasma geometry model uses Fourier coefficients to represent the complex
3-D plasma shape typical of stellarators. A VMEC~\cite{vmec} calculation (or
other equilibrium code that can provide the Fourier coefficients of the LCFS)
must have been performed prior to running with \process. The overall size of
the plasma is scaled correctly for the required (mean) major and minor radii
for the machine being modelled~\cite{geiger}.

It is necessary to provide three input files that define the plasma shape:

\begin{enumerate}

\item Set \texttt{vmec\_info\_file} in the input file to the name of a file
  with the following format (the numbers given are those for the W7-X high
  mirror configuration); in practice only the effective major and minor radius
  values (\texttt{R\_eff} and \texttt{a\_eff}, respectively) and the number of
  field periods are used:

\footnotesize
\begin{verbatim}
R_eff [m]   a_eff [m]   Aspect ratio   Plasma vol [m3]  LCFS surf area [m2]  field periods
5.486576    0.4942638   11.10050       26.45749         133.4281             5.0
\end{verbatim}
\normalsize

\item Set \texttt{vmec\_rmn\_file} in the input file to the name of a VMEC
  output file containing the calculated plasma boundary $R(m,n)$ Fourier
  coefficients, where $m = 0$ to 11 (rows) and $n = -12$ to 12 (columns).

\item Set \texttt{vmec\_zmn\_file} in the input file to the name of a VMEC
  output file containing the calculated plasma boundary $Z(m,n)$ Fourier
  coefficients, where $m = 0$ to 11 (rows) and $n = -12$ to 12 (columns).

\end{enumerate}

This method enables a wide range of potential plasma geometries to be
modelled, if required. The plasma volume, surface area and mean
cross-sectional area are the outputs from the plasma geometry model.

\subsubsection{Absense of plasma current}

Stellarators try to achieve zero plasma current in order to allow safe
divertor operation, so no current scalings are required.

\subsubsection{Beta limit}

The beta limit is assumed to be 5\%, based on 3-D MHD calculations
\cite{Nuhrenberg}. To apply the beta limit, constraint equation no.\ 24 should
be turned on with iteration variable no.\ 36 (\texttt{fbetatry}).

\subsubsection{Density limit}

The density limit relevant to stellarators has been proposed to be~\cite{LHD}
\begin{equation}
n_{\mbox{\scriptsize max}} = 0.25\left( P B_0 / R_0 \, a_p^2\right)^\frac{1}{2}
\end{equation}
where $n$ is the line-averaged electron density in units of
$10^{20}$~m$^{-3}$, $P$ is the absorbed heating power (MW), $B_0$ is the
on-axis field (T), $R_0$ is the major radius (m), and $a_p$ is the plasma
minor radius (m). To enforce the density limit, turn on constraint equation
no.\ 5 with iteration variable no.\ 9 (\texttt{fdene}).

\subsubsection{$\tau_E$ scaling laws}

%- a transport model which employs a predictive confinement time scaling
%derived from 1-D neoclassical and 3-D turbulence simulations

Five confinement time scaling laws relevant to stellarators are present
within \process. The value of switch \texttt{isc} determines which of these is
used in the plasma energy balance calculation.
\begin{eqnarray}
\tau_E\; (\mbox{Large Helical Device~\cite{LHD}: \texttt{isc=21}})
& = & 0.17 \, R_0^{0.75} \, a_p^2 \, \bar{n}_{20}^{0.69} \, B_0^{0.84} \, P^{-0.58} \\
\tau_E\; (\mbox{Gyro-reduced Bohm~\cite{Goldston}: \texttt{isc=22}})
 & = & 0.25 \, B_0^{0.8} \, \bar{n}_{20}^{0.6} \, P^{-0.6} \, a_p^{2.4} \, R_0^{0.6} \\
\tau_E\; (\mbox{Lackner-Gottardi~\cite{LacknerGottardi}: \texttt{isc=23}})
& = & 0.17 \, R_0 \, a_p^2 \, \bar{n}_{20}^{0.6} \, B_0^{0.8} \, P^{-0.6} \, \iota^{0.4} \\
\tau_E\; (\mbox{ISS95~\cite{Stroth}: \texttt{isc=37}})
& = & 0.079 \, R_0^{0.65} \, a_p^{2.21} \, \bar{n}_{19}^{0.51} \, B_0^{0.83}
\, P^{-0.59} \, \bar{\iota}^{0.4} \\
\tau_E\; (\mbox{ISS04~\cite{Yamada}: \texttt{isc=38}})
& = & 0.134 \, R_0^{0.64} \, a_p^{2.28} \, \bar{n}_{19}^{0.54} \, B_0^{0.84}
\, P^{-0.61} \, \bar{\iota}^{0.41}
\end{eqnarray}
Here, $\bar{\iota}$ is the rotational transform, which is equivalent to the reciprocal
of the tokamak safety factor $q$.

\subsubsection{Heating power options}

Stellarators require no current drive, although provision for auxiliary
heating does need to be present. The method by which auxiliary heating power
is supplied is determined by the switch \texttt{isthtr}:
\begin{description}
\item [\texttt{isthtr = 1} :] electron cyclotron resonance heating
\item [\texttt{isthtr = 2} :] lower hybrid heating
\item [\texttt{isthtr = 3} :] neutral beam injection
\end{description}
The value of variable \texttt{pheat} determines the actual amount of auxiliary
heating power (in Watts) to be applied to the plasma. This variable may be
used as an iteration variable (no.\ 11). Switch \texttt{ignite} may be used if
necessary --- see Section~\ref{sec:ignited}.

\subsubsection{Divertor}

Although the divertor has the same function in both stellarators and tokamaks,
the envisaged concepts differ quite substantially. This is not only related to
the different geometry and symmetries but also specifically to the magnetic
configuration. While the inherent axisymmetry of a tokamak allows for
poloidally-continuous single or double divertor configurations, the
periodicity of helical advanced stellarators leads to multiple X-points with a
corresponding chain of magnetic islands. This island structure may be
exploited by carefully placing divertor plates along the stochastic field
lines, naturally leading to a discontinuous divertor, with the individual
plates being placed in a complex 3-D geometry; see Figure~\ref{fig:stelldiv}.

\begin{figure}[tbph]
\centerline{\epsfig{file=stelldiv.eps,width=160mm}}
\caption[Stellarator island divertor configuration]
{\label{fig:stelldiv}
  \textit{A five-period HELIAS plasma (specifically W7-X) with island divertor
    plates shown in red}
}
\end{figure}

Rather than trying to describe the complex physics with a two-point scrape-off
layer model as is used for tokamaks, the stellarator divertor
model~\cite{stell_divertor} is based on fundamental principles which relate
the power crossing the separatrix with an effective wetted area on the
divertor plates allowing the code to estimate the heat load delivered to the
divertor. A basic island divertor model is used which assumes diffusive
cross-field transport and high radiation at the X-point,

The radiated power fraction in the scrape-off layer is given by the input
parameter \texttt{f\_rad}. This is in contrast to the method used for
tokamaks, in which the radiated power fraction is a calculated quantity.

A number of other input parameters may be used to modify the divertor model;
see the variable descriptor file for more details.

\subsection{Machine configuration}

There are a large number of possible stellarator configurations. As stated
earlier, the one chosen for the \process\ model is based on the
\textbf{HELI}cal \textbf{A}dvanced \textbf{S}tellarator (HELIAS) concept, in
which all the coils resemble distorted, non-planar TF coils --- no helical
coils or tokamak-like PF coils are present.  The coil geometry is scaled from
the HELIAS 5-B power plant design, which is based on a five field-period
HELIAS configuration.

\subsubsection{Machine build}
\label{sec:stbuild}

Since a stellarator is inherently non-axisymmetric, the build of the \process\
stellarator is defined in terms of the mean thicknesses of components.

The surface areas for the first wall, blanket and shield components are scaled
linearly with their effective minor radius from the plasma surface area
calculation (the area of a simple torus of circular cross-section is $4 \pi^2
R a$, hence the linear scaling with $a$). The input parameter \texttt{fhole}
may be used to specify the hole fraction, to adjust the surface area to
take account of ports and divertors, for instance. The volumes of the first
wall etc.\ are simply given by the product of their surface area and their
mean thickness.

In contrast to tokamaks, which in \process\ are assumed to have a cylindrical
external cryostat completely surrounding the fusion power core, the
stellarator model assumes that the external cryostat (labelled as the outer
vessel in Figure~\ref{fig:helias5b}) is toroidal with a circular
cross-section. Its cross-section is assumed to be centred at the mean plasma
major radius.

All items external to the fusion power core (buildings, turbines, power
conversion systems, etc.) remain unchanged.

\subsubsection{Stellarator coils}

The stellarator coil model~\cite{stell_coil, stell_coil2} combines scaling
aspects based on the HELIAS 5-B design in combination with analytic inductance
and field calculations.

The fully three-dimensional shape of the coils is assumed to be fixed, but the
sizes of the coils are scaled from the HELIAS 5-B values to the geometrical
values for the machine being modelled using fundamental physics and
engineering principles.

The stellarator coils are assumed to be superconducting --- no resistive coil
calculations are performed.  The critical field at the superconductor is
calculated using circular approximations for the coils in the inductance and
field calculations, and the limit is enforced automatically. Available
superconductors are Nb$_3$Sn (\texttt{isumattf = 1}) and NbTi
(\texttt{isumattf = 3}).

The winding pack cross-section is rectangular for the stellarator coils,
rather than the complicated two-step cross-section assumed for tokamaks. The
coil thicknesses and most of the dimensions of the materials within the coil
cross-section are outputs from the model, instead of being inputs as is the
case for tokamaks; see the variable descriptor file for details. In addition,
certain iteration variables (\texttt{tfcth}, no.\ 13; \texttt{thkcas}, no.\
57; \texttt{cpttf}, no.\ 60 and \texttt{tftort}, no.\ 77) should not be turned
on in the input file as they are calculated self-consistently; the code will
stop with an error message if this is attempted.

\section{Reversed Field Pinch Model}

In addition to the tokamak and stellarator magnetic confinement devices, the
code has the ability to perform calculations based on the physics and
engineering of a reversed field pinch (RFP) device. This third type of
toroidal magnetic device is superficially similar in design to a tokamak (so
therefore shares many of the same components), but the magnetic field
configuration differs.

The model used in \process\ is largely based on the TITAN fusion power
plant~\cite{titan1,titan2}. The following sections summarise its main
features, where they differ from those for tokamaks.

To activate the RFP coding, it is necessary to create a file
\texttt{device.dat}, containing the single character \texttt{2} in the first
row, in the working directory (see Section~\ref{sec:infile}). This has the
effect of setting the internally-used switch \texttt{irfp = 1}. If the file is
absent, or its first character is set to something other than \texttt{2}, the
RFP model is not used, and \texttt{irfp} is set to \texttt{0}.

\subsection{RFP physics}

The plasma in RFPs is circular in cross-section and is axisymmetric.

\subsubsection{Beta limit}

The poloidal beta is limited to a maximum value given by input parameter
\texttt{betpmx} (default = 0.19) using constraint equation~48 and iteration
variable~79 (\texttt{fbetap}).

\subsubsection{Density limit}

No density limit is explicitly coded for RFPs, other than by simply
constraining the upper bound of the electron density variable \texttt{dene}
(iteration variable 6).

\subsubsection{$\tau_E$ scaling law}

One confinement time scaling law relevant to RFPs is present within
\process. The value of switch \texttt{isc} determines the scaling to be used
in the plasma energy balance calculation.
\[
\tau_E\; (\mbox{TITAN RFP~\cite{titan1}: \texttt{isc=25}})
 = 0.05 \, a^2 \, I_p(\mathrm{MA})
\]

\subsubsection{$F$-$\Theta$ plot}

Much of the RFP physics is derived from the characteristic $F$-$\Theta$ plot,
where $F = B_\phi (a)/\langle B_\phi \rangle$, $\Theta = B_\theta (a)/\langle
B_\phi \rangle$, and $\langle B_\phi \rangle$ is the average value of the
toroidal field over the plasma cross-section. Given a value of the pinch
parameter $\Theta$, the corresponding value of the reversal parameter $F$ may
be read from the $F$-$\Theta$ plot, and from these the plasma current and the
current in the TF coils may be obtained using

\begin{eqnarray*}
  B_\theta (a) & = & \frac{\mu_0 I_p}{2\pi a} \\
  B_\phi (a)   & = & \frac{\mu_0 I_{TFC}}{2\pi R}
\end{eqnarray*}
(the second of these assumes that $B_\phi (a)$ is approximately equal to the
vacuum toroidal field at the plasma centre).

The pinch parameter $\Theta$ is set using iteration variable no.\ 78:
\texttt{rfpth}. The corresponding value of the reversal parameter $F$
(\texttt{rfpf}) is calculated using routine \texttt{FTHETA}. $F$ is
constrained to be negative using constraint equation no.\ 49 with f-value
\texttt{frfpf} (iteration variable no.\ 80).

\subsubsection{Current drive}
\label{sec:rfpcd}

The RFP oscillating field current drive option is turned on by setting
\texttt{iefrf = 9}, with a fixed efficiency of 0.8~Amps per Watt of power
injected into the plasma (the coding for this model is, therefore,
trivial). The wall plug to injector efficiency is set using input parameter
\texttt{etaof}, which has a default value of 0.5, and the unit cost is set
using input parameter \texttt{ucof}. The default value for \texttt{ucof} is
3.3~\$ per Watt of injected power.

The bootstrap fraction is assumed to be zero.

Plasma ignition, and additional plasma heating using auxiliary power, are
treated as for tokamaks.

\subsection{TF coils}

The TF coils for the RFP option are derived from the TITAN-II coil set, which
uses circular copper coils. The radial thickness is set using \texttt{tfcth}
as usual, but the toroidal thickness may also be set, using iteration variable
no.\ 77 (\texttt{tftort}). This is constrained to be no larger than is
geometrically possible using constraint equation no.\ 47 with iteration
variable no.\ 76 (\texttt{frfptf}).

\subsection{Ohmic heating coils}

The TITAN-I ohmic heating coil locations, currents etc.\ are assumed. These
comprise 14 copper coils, with currents swinging from positive to negative
during the plasma start-up period, and then decaying back to zero. To account
for different plasma geometries and currents, the ohmic heating coil locations
relative to the plasma centre scale with the TF coil radius and with the
plasma major radius, and the current per turn scales linearly with the plasma
current.

\subsection{EF coils}

The Equilibrium Field coils are based on the TITAN-I EF coils, which are two
superconducting (NbTi) coils that provide the correct vertical field at the
plasma centre. The coil locations scale with the plasma major radius and TF
coil radius along with the ohmic heating coils.

\subsection{Divertor}

The TITAN divertor concept uses three poloidal divertors, which bear little
resemblance to the typical tokamak toroidal divertor systems. The code uses
the TITAN divertor lifetime of one year to enable the divertor costs to be
reasonable, although the divertor surface area (and therefore the cost per
divertor) is likely to be inaccurate.
%!%!%! perhaps we could recalculate divsur properly for RFPs...

\subsection{Code modifications}

As with the stellarator model, the RFP model has been incorporated in such a
way as to allow its simple removal again if required in the future. All new
routines are confined to the dedicated source file \texttt{rfp.f90}. The
tokamak-relevant consistency equations in \process\ (see
Section~\ref{sec:constraints}) are used without modification, to ensure that
the coil currents and the fields they produce are consistent with the plasma
parameters.

\section{Inertial Fusion Energy Model}
\label{sec:ife}

As well as magnetic confinement devices, \process\ has the ability to model
inertial fusion plants, in which a laser or ion beam is used to ignite a
target pellet containing the fusion fuel.

To activate the inertial fusion energy (IFE) coding, it is necessary to create
a file \texttt{device.dat}, containing the single character \texttt{3} in the
first row, in the working directory (see Section~\ref{sec:infile}). This has
the effect of setting the internally-used switch \texttt{ife = 1}. If the file
is absent, or its first character is set to something other than \texttt{3},
the IFE model is not used, and \texttt{ife} is set to \texttt{0}.

The IFE model~\cite{process_ife} is controlled using two additional switches.
\begin{description}
\item [\texttt{ifetyp = 0} :] Generic device build
\item [\texttt{ifetyp = 1} :] OSIRIS-type device build~\cite{osiris1,osiris2,osiris3}
\item [\texttt{ifetyp = 2} :] SOMBRERO-type device build~\cite{sombrero1,sombrero2}
\item [\texttt{ifetyp = 3} :] HYLIFE-II-type device build~\cite{hylife1,hylife2,hylife3}
\end{description}
Switch \texttt{ifetyp} defines the type of device that is assumed; this varies
widely between different conceptual designs. The generic type assumes a
cylindrically symmetric device, while the other types are approximations to
the builds of the given conceptual machines~\cite{ife_build}. In general, the
build from the centre of the device (at the target ignition location) is in
the order: chamber, first wall, gap, blanket, gap, shield, gap, building
wall. The user specifies the thicknesses of these regions, and also the
materials that are present and in what proportions. \Red{[expand]} %!%!%!

\begin{description}
\item [\texttt{ifedrv = -1} :] Driver efficiency and target gain are input as
  functions of driver energy
\item [\texttt{ifedrv = 0} :] Driver efficiency and target gain are input
\item [\texttt{ifedrv = 1} :] SOMBRERO laser drive efficiency and target gain assumed
\item [\texttt{ifedrv = 2} :] OSIRIS heavy ion beam driver efficiency and
  target gain are assumed~\cite{ife_driver}
\end{description}
Switch \texttt{ifedrv} defines how the code calculates the driver efficiency
and target gain --- these are the primary outputs required from the physics
part of the model. For the SOMBRERO and OSIRIS cases (\texttt{ifedrv = 1} and
\texttt{ifedrv = 2}, respectively) the driver efficiency and gain are
calculated from curves of these parameters as functions of the driver
energy. For the \texttt{ifedrv = -1} case, the user provides the driver
efficiency and target gain versus driver energy, via the two arrays
\texttt{etave(1:10)} and \texttt{gainve(1:10)} respectively; the element number
corresponds to the driver energy in MJ, and outside the range 1--10~MJ the
curves are extrapolated linearly. Finally, for the \texttt{ifedrv = 0} case,
the user inputs single values for the driver efficiency (\texttt{drveff}) and
target gain (\texttt{tgain}).

Constraint equation no.\ 50 can be turned on to enable the ignition repetition
rate to remain below a user-specified upper limit (\texttt{rrmax}); iteration
variable no.\ 86 (\texttt{frrmax}) is the associated f-value (see
Section~\ref{sec:constraints}). The other iteration variables relevant for the
IFE model are nos.~81--85 (\texttt{edrive}, \texttt{drveff}, \texttt{tgain},
\texttt{chrad} and \texttt{pdrive} --- see Table~\ref{tab:itvars2}).

\section{Safety and Environment Models}

At present, the neutronics, activation and inventory calculations comprise the
safety and environment models in the code.

The models comprising the safety and environmental calculations~\cite{FISPACT}
within the code are all called from routine \texttt{FISPAC}. They are only
performed once, at the end of each run, as they take a relatively long time to
evaluate, and the results are only used for diagnostic purposes --- no
constraints are imposed at present to minimise doses, for instance.
% AND LOCA in safety.f90...

N.B.\ These models are currently not available in the present version of the
code.

\subsection{Neutronics}

The neutronics module predicts the neutron flux spectra in the inboard and
outboard first wall and blanket components. The spectra are based on a
simplified tokamak device that has a fixed ratio ($=1.5825$) between the
outboard blanket thickness and the inboard blanket thickness, and are scaled
according to the actual thickness of the outboard blanket. This relatively
limited, single-parameter approach is expected to be replaced by a more
general method, which should allow a more accurate portrayal of the device
being modelled by \process.

\subsection{Activation and inventory information}

The code evaluates the consequences of exposing the power plant's materials to
the calculated neutron fluxes, subject to the limitations imposed by the
neutronics module. A library of neutron cross-sections and decay data is used
to calculate the total activity, gamma-ray dose rate and decay heat output due
to the materials' exposure to neutrons, both at the end of the plant's life
and at a time 100 years later. These values are relevant to decommissioning
and disposal studies, and additional parameters that can be obtained from the
nuclide inventory will also be included as the need arises.

\section{Cost Models}

The cost accounting used by \process\ combines methods~\cite{cost1} used in
the TETRA code~\cite{tetra} and the Generomak~\cite{generomak} scheme.  The
costs are split into the standard accounting categories~\cite{cost2} generally
used in the reporting of power plant costs. The best references for the
algorithms used are~\cite{storac}, and source file \texttt{costs.f90} in the
code itself.

The majority of the costed items have a unit cost associated with them. These
values scale with (for example) power output, volume, component mass etc., and
many are available to be changed via the input file. All costs and their
algorithms correspond to 1990 dollars.

\subsection{Cost options}

\subsubsection{$N^{th}$ of a kind costs}

The unit costs of the components of the fusion power core are relevant to
``first-of-a-kind'' items. That is to say, the items are assumed to be
relatively expensive to build as they are effectively prototypes and
specialised tools and machines have perhaps been made specially to create
them. However, if a ``production line'' has been set up, and R \& D progress
has allowed more experience to be gained in constructing the power core
components, the costs will be reduced as a result. Variable \texttt{fkind} may
be used to multiply the raw unit costs of the fusion power core items (by a
factor less than one) to simulate this cost reduction for an
$N^{th}$-of-a-kind device. In other systems studies of fusion power
plants~\cite{galambos}, values for this multiplier have ranged from 0.5 to
0.8.

\subsubsection{Level of safety assurance}

Many of the unit costs have four possible choices, relating to the level of
safety assurance~\cite{lsa} flag \texttt{lsa}. A value \texttt{lsa = 1}
corresponds to a plant with a full safety credit (i.e.\ is truly passively
safe). Levels \texttt{2} and \texttt{3} lie between the two extremes, and
level \texttt{4} corresponds to a present day fission reactor, with no safety
credit.

\subsubsection{Replaceable components}

The first wall, blanket, divertor, centrepost (if present) and current drive
system have relatively short lifetimes because of their hostile environment,
after which they must be replaced. Because of this frequent renewal they can
be regarded as though they are ``fuel'' items, and can be costed
accordingly. Switch \texttt{ifueltyp} is used to control whether this option
is used in the code. If \texttt{ifueltyp = 1}, the costs of the first wall,
blanket, divertor and a fraction \texttt{fcdfuel} of the cost of the current
drive system are treated as fuel costs. If \texttt{ifueltyp = 0}, these are
treated as capital costs.

\subsubsection{Cost of electricity calculations}

Switch \texttt{ireactor} determines the type of cost of electricity
calculation that is performed. If \texttt{ireactor = 0}, no cost of
electricity calculation is performed. If \texttt{ireactor = 1}, then the cost
of electricity is evaluated, with the value quoted in units of m\$/kWh.

\subsubsection{Net electric power calculation}

Related to the cost of electricity is the net electric power calculation
performed in routine \texttt{POWER}. It is possible that the net electric
power can become negative due to a high recirculating power. Switch
\texttt{ipnet} determines whether the net electric power is scaled to always
remain positive (\texttt{ipnet = 0}), or whether it is allowed to become
negative (\texttt{ipnet = 1}), in which case no cost of electricity
calculation is performed.

\section{Other Switches and Models}

\subsection{Diagnostic output}

Switch \texttt{verbose} can be set to \texttt{1} in the input file to allow
the code to write some additional diagnostic output to the screen. Currently,
extra information about the progress of the optimiser is produced. This
setting is likely to be of interest only to ``expert'' users.

\subsection{Code parameters affecting other models}

This chapter has summarised the methods by which several of the models in the
code can be activated. There are many others present, however, and it is
suggested that the user refers to the variable descriptor file,
\texttt{vardes.html}. As stated earlier in Section~\ref{sec:vardes}, this
contains details of all the parameters within the code that can be changed by
the user, in order to customise the machine modelled by \process.

