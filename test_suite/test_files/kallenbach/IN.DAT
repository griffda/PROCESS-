
runtitle = 'Kallenbach divertor model'

*---------------Constraint Equations---------------*
icc = 1 * Beta
icc = 2 * Global power balance

* Density and densitly limit
icc = 5 * Density upper limit
ixc = 9 * fdene
boundu(9) = 1.2
fdene     = 1.2 * F-value for density limit
ixc = 6 * dene
boundl(6) =  6.0E+19
dene      = 7.5e+19 * Electron density (/m3) (iteration variable 6)

icc = 8 * Neutron wall load upper limit
ixc = 14 * fwalld
fwalld  = 0.13 * F-value for maximum wall load
walalw  = 8.0 * Allowable wall-load (mw/m2)

icc = 10 * Toroidal field 1/R (consistency equation)
icc = 11 * Radial build (consistency equation)

icc = 13 * Burn time lower limit
tbrnmn  = 7.2e3 * Minimum burn time (s)
ixc = 21 * ftburn f-value for burn time limit equation
boundl(21) = 0.001
boundu(21) = 1.002
ftburn   = 1.0 * F-value for minimum burn time

icc = 15 * L-H power threshold limit
ixc = 103 * flhthresh
boundu(103) = 10.0
flhthresh   = 1.35 * F-value for l-h power threshold

icc = 16 * Net electric power lower limit
fpnetel  = 1.0 * F-value for net electric power
pnetelin = 500.0 * Required net electric power (Mw)

icc = 24 * Beta upper limit
ixc = 36 * fbetatry
fbetatry = 0.5 * F-value for beta limit
ixc = 5 * beta
beta   = 0.035

icc = 60 * Central solenoid temperature margin lower limit
ixc = 106 * ftmargoh (f-value for equation 60)

icc = 30 * Injection power upper limit
pinjalw = 50.0 * Maximum allowable value for injected power (mw)
ixc = 46 * fpinj (f-value for equation 30)

icc = 31 * TF coil case stress upper limit
ixc = 48 * fstrcase

icc = 32 * TF coil conduit stress upper limit
ixc = 49 * fstrcond
alstrtf  = 6.0E8 * allowable stress in TF coil (Pa)

icc = 34 * Dump voltage upper limit
ixc = 51 * fvdump
fvdump  = 0.9 * F-value for dump voltage (constraint equation 34)
ixc = 52 * vdalw maximum voltage across TF coil during quench (kV)
boundu(52) = 10.0
vdalw   = 10.00 * Max voltage across tf coil during quench (kv)
* Why is this an iteration variable?
ixc = 56 * tdmptf
tdmptf  = 25.0 * Dump time for tf coil (s)

icc = 35 * J_winding pack/J_protection upper limit (TFC)
ixc = 53 * fjprot
fjprot  = 1.0 * F-value for tf coil winding pack current density

icc = 36 * TF temp margin  See tmargmin
tmargmin = 1.500 * Minimum allowable temperature margin (cs and tf coils) (k)
ixc = 54 * ftmargtf

icc = 62  * taup/taueff the ratio of particle to energy confinement times
ixc = 109 * ralpne  Thermal alpha density / electron density
boundl(109) = 0.01
boundu(109) = 0.2
ixc = 110 * ftaulimit: f-value for lower limit on taup/taueff the ratio of alpha particle to energy confinement
boundl(110) = 0.001
boundu(110) = 1.0
ftaulimit = 1.0
ralpne   = 0.1 * Thermal alpha density / electron density
*taulimit = 5.0 * Lower limit on taup/taueff the ratio of alpha particle to energy confinement times


icc = 65 * dump time by VV stresses
sigvvall= 9.3e7 * allowable stress from TF quench in vacuum vessel (Pa)

* Ramp up and down times
icc = 66 * Limit on rate of change of energy in poloidal field (Use iteration variable 65(tohs))
maxpoloidalpower = 300 * Maximum permitted absolute rate of change of stored energy in poloidal field (MW)
ixc = 115 * fpoloidalpower: f-value for max rate of change of energy in poloidal field
fpoloidalpower = 0.35
*ixc = 65 * tohs
*boundl(65) = 290.0
*boundu(65) = 310.0
tohs   = 300 * OH ramp up time (s)

icc = 68 * Pseparatrix Bt / q A R
psepbqarmax = 9.5D0 * maximum ratio of Psep*Bt/qAR (MWT/m)

* SOL model
* ---------
icc = 69 * Separatrix power < than value from Kallenbach divertor (Use iteration variable 118 (fpsep))
*ixc = 118 * fpsep: f-value to ensure separatrix power is related to that from Kallenbach divertor
*boundl(118) = 0.99
*boundu(118)=1.01
fpsep = 1.0

* Separatrix temperature
icc = 70 * ensure that teomp is equal to the separatrix temperature in the pedestal profile (Use iteration variable 119 (tesep))
ixc = 119 * tesep
boundl(119) = 0.1
boundu(119) = 10.0
tesep       = 0.2 * Electron temperature at separatrix (kev) (ipedestal=1)

* Divertor target plasma temperature
ixc = 120 * ttarget  Plasma temperature adjacent to divertor sheath [eV]
boundl(120) = 0.1
boundu(120) = 3.0
ttarget     = 3.0  * Plasma temperature adjacent to divertor sheath [eV]

icc = 71       * ensure that neomp is equal to the separatrix density (nesep) x neratio
*ixc = 121       * neratio: ratio of mean SOL density at OMP to separatrix density at OMP
*boundl(121) = 0.1
*boundu(121) = 0.9
neratio = 0.9  * ratio of mean SOL density at OMP to separatrix density at OMP
fgwsep = 0.5    * Electron density at separatrix / nGW

icc = 72  * central solenoid Tresca stress limit
ixc = 123 * foh_stress : f-value for CS coil Tresca stress limit (see asltroh)
alstroh = 6.0D8 * allowable TRESCA stress in Central Solenoid structural material (Pa)


*---------------Other Iteration Variables----------------*

ixc = 2 * bt
boundu(2) = 10.0
bt = 5.3

ixc = 3 * rmajor
boundl(3) = 8.9
boundu(3) = 12
rmajor    = 9.4 * Plasma major radius (m) (iteration variable 3)

ixc = 4 * te
boundl(4) = 10.0
boundu(4) = 30.0
te        = 13.07 * Volume averaged electron temperature (kev)

ixc = 10 * hfact
boundu(10) = 1.1
hfact    = 1.1 * H factor on energy confinement times (iteration variable 10)

ixc = 12 * oacdcp
oacdcp   = 9.5E+06 * Overall current density in tf coil inboard legs (a/m2)

ixc = 13 * tfcth
tfcth = 1.0

ixc = 16 * ohcth
boundl(16) = 0.8
boundu(16) = 2.0
ohcth      = 1.0 * Central solenoid thickness (m)

ixc = 18 * q
boundl(18) = 3.0
q          = 3.0 * Safety factor 'near' plasma edge (iteration variable 18)

ixc = 29 * bore
boundl(29) = 1.5
bore       = 2.3

ixc = 37 * coheof
boundu(37) = 2.0e7
coheof   = 1.2e7 * Central solenoid overall current density at end of flat-top (a/m2)

ixc = 41 * fcohbop
boundl(41) = 0.5
fcohbop    = 0.9

ixc = 42 * gapoh
boundl(42) = 0.05
boundu(42) = 0.1
gapoh      = 0.05 * Gap between central solenoid and tf coil (m)
* Why is this an iteration variable?

ixc = 44 * fvsbrnni
fvsbrnni = 0.48 * Fraction of the plasma current produced by non-inductive means

ixc = 57 * thkcas
thkcas  = 0.5 * Inboard tf coil case outer (non-plasma side) thickness (m)

ixc = 58 * thwcndut
boundl(58) = 0.008
thwcndut   = 0.008 * Tf coil conduit case thickness (m)

ixc = 61 * gapds
boundl(61) = 0.02
boundu(61) = 0.12
gapds      = 0.02 * Gap between inboard vacuum vessel and tf coil (m)
* Why is this an iteration variable?

ixc = 102 * fimpvar
* See impurity variables

ixc = 113 *ftaucq

ixc = 117 *fpsepbqar
fpsepbqar = 7.0E-01

ixc = 60 * cpttf
boundl(60) = 6.0e4
boundu(60) = 9.0e4
cpttf      = 9.0e+04 * Tf coil current per turn (a)

ixc = 59 * copper fraction of cable conductor (TF coils)
boundu(59) = 0.94
fcutfsu    = 0.8

ixc = 122 * oh_steel_frac : streel fraction of OH coil
oh_steel_frac = 8.6E-01 * central solenoid steel fraction (iteration variable 122)

ixc = 124 * qtargettotal : Total power density on target [W/m2]
boundl(124) = 1.0e6
boundu(124) = 10.0e6
qtargettotal = 3.0e6       * Power density on target including surface recombination [W/m2]

ixc = 125 *  fimp(9) : argon density fraction relative to electron density
boundl(125) = 0.0
boundu(125) = 0.01
fimp(9) = 0.001
*-----------------Build Variables------------------*
blnkith  = 0.755 * Inboard blanket thickness (m);
blnkoth  = 1.275 * Outboard blanket thickness (m);
ddwex    = 0.15 * Cryostat thickness (m)
ddwi     = 0.32 * Vacuum vessel thickness (tf coil / shield) (m)
gapomin  = 0.20 * Minimum gap between outboard vacuum vessel and tf coil (m)
iohcl    = 1 * Switch for existence of central solenoid;
scrapli  = 0.225 * Gap between plasma and first wall; inboard side (m)
scraplo  = 0.225 * Gap between plasma and first wall; outboard side (m)
shldith  = 0.30 * Inboard shield thickness (m)
shldoth  = 0.80 * Outboard shield thickness (m)
shldtth  = 0.30 * Upper/lower shield thickness (m);
vgap2    = 0.12 * Vertical gap between vacuum vessel and tf coil (m)
vgaptf   = 1.60 * Vertical gap between x-point and divertor (m)

*---------------Constraint Variables---------------*
*------------------Cost Variables------------------*
output_costs = 0
cost_model = 0
iavail   = 0 * Switch for plant availability model;
ifueltyp = 1 * Switch;

*-------------Current Drive Variables--------------*
bscfmax  = 0.99 * Maximum fraction of plasma current from bootstrap;
iefrf    = 10 * Switch for current drive efficiency model;
gamma_ecrh = 0.30 * ECRH gamma_CD (user input)
etaech = 0.4 * ECRH wall-plug efficiency

*----------------Divertor Variables----------------*
Kallenbach_switch = 1
Kallenbach_tests = 0
helium_enrichment = 1.0    * Ratio of helium concentration in SOL to confined plasma
impurity_enrichment=5.0d0  * Ratio of impurity concentrations in SOL to confined plasma
lambda_target=5.0d-3        * SOL power fall-off length at the target, perpendicular to field [m]

netau = 0.5                * Parameter describing the departure from local ionisation equilibrium in the SOL. [ms.1e20/m3]
lambda_q = 0.002
targetangle = 5.0          * Angle between field-line and divertor target (degrees)
lengthofwideSOL = 40.0     * Distance from target at which SOL power fall-off length changes [m]


*------------------Fwbs Variables------------------*
vfshld   = 0.60 * Coolant void fraction in shield

*-----------------Global Variables-----------------*
*-------------Heat Transport Variables-------------*
etath    = 0.375 * Thermal to electric conversion efficiency; input if ipowerflow=0
ipowerflow = 0 * Switch for power flow model;
primary_pumping = 0 * Switch for pumping power for primary coolant

* Set total primary electrical pumping power to 155 MW
htpmw_div = 0
htpmw_shld = 0
htpmw_blkt = 0 * blanket primary pumping power He (MW)
etahtp = 1.0 * mechanical pump wall-plug efficiency
htpmw_fw = 155 * first wall primary pumping power He (MW)

*------------Impurity Radiation Module-------------*
imprad_model = 1 * Switch for impurity radiation model;
coreradius = 0.75 * Normalised radius defining the 'core' region
coreradiationfraction = 0.6 * fraction of radiation from 'core' region that is subtracted from the loss pow
fimp(1) = 1.0
fimp(2) = 0.1
fimp(3) = 0.0
fimp(4) = 0.0
fimp(5) = 0.0
fimp(6) = 0.0
fimp(7) = 0.0
fimp(8) = 0.0
*fimp(9) = 0.0
fimp(10) = 0.0
fimp(11) = 0.0
fimp(12) = 0.0
*fimp(13) = 0.000
fimp(14) = 5e-05
fimpvar  = 2.5E-04 * Impurity fraction to be used as fimp(impvar)
impvar   = 13 * Fimp element value to be varied if iteration

*---------------------Numerics---------------------*
ioptimz  = 1 * for optimisation VMCON only
minmax   = 1 * Switch for figure-of-merit (see lablmm for descriptions)
epsvmc   = 1.0e-4 * Error tolerance for vmcon
maxcal   = 100

*----------------Pf Power Variables----------------*

*-----------------Pfcoil Variables-----------------*
isumatoh = 5 * switch for superconductor material in central solenoid

coheof   = 13540000.0 * Central solenoid overall current density at end of flat-top (a/m2)
cptdin   = 4.22d4, 4.22d4, 4.22d4, 4.22d4, 4.3d4, 4.3d4,  4.3d4, 4.3d4, * Peak current per turn input for pf coil i (a)

ipfloc   = 2,2,3,3 * Switch for locating scheme of pf coil group i;
isumatpf = 3 * Switch for superconductor material in pf coils;
ncls     = 1,1,2,2, * Number of pf coils in group j
ngrp     = 4 * Number of groups of pf coils;
ohhghf   = 0.9 * Central solenoid height / tf coil internal height
rjconpf  = 1.1d7, 1.1d7, 6.d6, 6.d6, 8.d6, 8.0d6, 8.0d6, 8.0d6, * Average winding pack current density of pf coil i (a/m2)
rpf2     = -1.825 * Offset (m) of radial position of ipfloc=2 pf coils
zref(1) = 3.6
zref(2) = 1.2
zref(3) = 1.0
zref(4) = 2.8
zref(5) = 1.0
zref(6) = 1.0
zref(7) = 1.0
zref(8) = 1.0

*----------------Physics Variables-----------------*
alphan   = 1.00 * Density profile index
alphat   = 1.45 * Temperature profile index
aspect   = 3.1 * Aspect ratio (iteration variable 1)

dnbeta   = 3.0 * (troyon-like) coefficient for beta scaling;
fkzohm   = 1.0245 * Zohm elongation scaling adjustment factor (ishape=2; 3)
gamma    = 0.3 * Ejima coefficient for resistive startup v-s formula
ibss     = 4 * Switch for bootstrap current scaling;
iculbl   = 1 * Switch for beta limit scaling (constraint equation 24);
icurr    = 4 * Switch for plasma current scaling to use;
idensl   = 7 * Switch for density limit to enforce (constraint equation 5);
ifalphap = 1 * Switch for fast alpha pressure calculation;
ifispact = 0 * Switch for neutronics calculations;
ipedestal = 1 * Switch for pedestal profiles;
iscdens = 1 * set pedestal-top density as fgwped * Greenwald density limit

fgwped = 0.85 * fraction of Greenwald density to set as pedestal-top density
neped    = 0.678e20 * Electron density of pedestal (/m3) (ipedestal=1)

rhopedn  = 0.94 * R/a of density pedestal (ipedestal=1)
rhopedt  = 0.94 * R/a of temperature pedestal (ipedestal=1)
tbeta    = 2.0 * Temperature profile index beta  (ipedestal=1)
teped    = 5.5 * Electron temperature of pedestal (kev) (ipedestal=1)

iprofile = 1 * Switch for current profile consistency;
isc      = 34 * Switch for energy confinement time scaling law
ishape   = 2 * Switch for plasma cross-sectional shape calculation;

q0       = 1.0 * Safety factor on axis
*ralpne   = 0.1 * Thermal alpha density / electron density (iteration variable 109)
snull    = 1 * Switch for single null / double null plasma;
ssync    = 0.6 * Synchrotron wall reflectivity factor
triang   = 0.5 * Plasma separatrix triangularity (calculated if ishape=1; 3 or 4)
zfear    = 1 * High-z impurity switch; 0=iron; 1=argon

*-----------------Pulse Variables------------------*
lpulse = 1 * Switch for reactor model;
tdwell = 0 * dwell time (s)

*-------------------Scan Module--------------------*
*isweep   = 1  * Number of scan points to calculate
*nsweep   = 36  * Switch denoting quantity to scan
*31 taulimit
*32 epsvmc
*33 ttarget
*34 qtargettotal
*35 lambda_q
*36 lambda_target
*sweep    = 0.010 * Actual values to use in scan
*-----------------Tfcoil Variables-----------------*
itfsup   = 1  * switch for TF coil conductor model 1=superconductor
isumattf = 5
casthi   = 0.06 * Inboard tf coil case inner (plasma side) thickness (m)
casths   = 0.05 * Inboard tf coil sidewall case thickness (m)
ripmax   = 0.6 * maximum allowable toroidal field ripple amplitude at plasma edge (%)
tfno     = 16 * Number of tf coils
dhecoil  = 0.010 * diameter of He coil in TF winding (m)
tftmp    = 4.750 * Peak helium coolant temperature in tf coils and pf coils (k)
thicndut = 0.0015 * Conduit insulation thickness (m)
tinstf   = 0.008 * Ground insulation thickness surrounding winding pack (m)
vftf     = 0.300 * Coolant fraction of tfc 'cable' (itfsup=1)

*-----------------Times Variables------------------*

*-----------------Vacuum Variables-----------------*
*-----------------Vacuum Variables-----------------*
