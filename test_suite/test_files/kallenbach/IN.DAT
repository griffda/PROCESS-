runtitle = 'Kallenbach divertor model'
*--------------------------------------------------*
*---------------Constraint Equations---------------*

neqns = 23 * Number of equality constraints to be satisfied
icc(1) = 1 * Beta
icc(2) = 2 * Global power balance
icc(3) = 5 * Density upper limit
icc(4) = 8 * Neutron wall load upper limit
walalw  = 8.0 * Allowable wall-load (mw/m2)

icc(5) = 10 * Toroidal field 1/R (consistency equation)
icc(6) = 11 * Radial build (consistency equation)
icc(7) = 13 * Burn time lower limit
tbrnmn  = 7.2e3 * Minimum burn time (s)

icc(8) = 15 * L-H power threshold limit
icc(9) = 16 * Net electric power lower limit
pnetelin = 500.0 * Required net electric power (Mw)

icc(10) = 24 * Beta upper limit
icc(11) = 60 * Central solenoid temperature margin lower limit

icc(12) = 30 * Injection power upper limit
pinjalw = 50.0 * Maximum allowable value for injected power (mw)

icc(13) = 31 * TF coil case stress upper limit
icc(14) = 32 * TF coil conduit stress upper limit
alstrtf  = 6.0E8 * allowable stress in TF coil (Pa)

icc(15) = 34 * Dump voltage upper limit
vdalw   = 10.00 * Max voltage across tf coil during quench (kv)

icc(16) = 35 * J_winding pack/J_protection upper limit (TFC)
icc(17) = 68 * Pseparatrix Bt / q A R
psepbqarmax = 9.5D0 * maximum ratio of Psep*Bt/qAR (MWT/m)

icc(18) = 65 * dump time by VV stresses
sigvvall= 9.3e7 * allowable stress from TF quench in vacuum vessel (Pa)

icc(19) = 36 * TF temp margin  See tmargmin

icc(20) = 66 * Limit on rate of change of energy in poloidal field (Use iteration variable 65(tohs))
maxpoloidalpower = 300 * Maximum permitted absolute rate of change of stored energy in poloidal field (MW)

icc(21) = 69 * Separatrix power < than value from Kallenbach divertor (Use iteration variable 118 (fpsep))
icc(22) = 70 * ensure that tomp is equal to the separatrix temperature in the pedestal profile (Use iteration variable 119 (tesep))
*icc(22) = 71 * ensure that neomp is equal to the separatrix density (nesep) x neratio

icc(23) = 72 * central solenoid Tresca stress limit
alstroh = 6.0D8 * allowable TRESCA stress in Central Solenoid structural material (Pa)
*---------------Iteration Variables----------------*

nvar = 44 * Number of iteration variables to use

ixc(1) = 2 * bt
boundu(2) = 10.0
bt = 5.3

ixc(2) = 3 * rmajor
boundl(3) = 8.9
boundu(3) = 12
rmajor    = 9.4 * Plasma major radius (m) (iteration variable 3)

ixc(3) = 4 * te
boundl(4) = 10.0
boundu(4) = 30.0
te        = 13.07 * Volume averaged electron temperature (kev)

ixc(4) = 5 * beta
beta   = 0.035

ixc(5) = 6 * dene
boundl(6) =  6.0E+19
dene      = 7.5e+19 * Electron density (/m3) (iteration variable 6)

ixc(6) = 9 * fdene
boundu(9) = 1.2
fdene     = 1.2 * F-value for density limit

ixc(7) = 10 * hfact
boundu(10) = 1.1

ixc(8) = 12 * oacdcp
oacdcp   = 9.5E+06 * Overall current density in tf coil inboard legs (a/m2)

ixc(9) = 13 * tfcth
tfcth = 1.0

ixc(10) = 14 * fwalld
fwalld  = 0.13 * F-value for maximum wall load

ixc(11) = 16 * ohcth
boundl(16) = 0.8
boundu(16) = 2.0
ohcth      = 1.0 * Central solenoid thickness (m)

ixc(12) = 18 * q
boundl(18) = 3.0
q          = 3.0 * Safety factor 'near' plasma edge (iteration variable 18)

ixc(13) = 29 * bore
boundl(29) = 1.5
bore       = 2.3

ixc(14) = 36 * fbetatry
fbetatry = 0.5 * F-value for beta limit

ixc(15) = 37 * coheof
boundu(37) = 2.0e7
coheof   = 1.2e7 * Central solenoid overall current density at end of flat-top (a/m2)

ixc(16) = 41 * fcohbop
boundl(41) = 0.5
fcohbop    = 0.9

ixc(17) = 42 * gapoh
boundl(42) = 0.05
boundu(42) = 0.1
gapoh      = 0.05 * Gap between central solenoid and tf coil (m)
* Why is this an iteration variable?

ixc(18) = 44 * fvsbrnni
fvsbrnni = 0.48 * Fraction of the plasma current produced by non-inductive means

ixc(19) = 48 * fstrcase
ixc(20) = 49 * fstrcond

ixc(21) = 51 * fvdump
fvdump  = 0.9 * F-value for dump voltage (constraint equation 34)

ixc(22) = 52 * vdalw maximum voltage across TF coil during quench (kV)
* Why is this an iteration variable?
boundu(52) = 10.0

ixc(23) = 53 * fjprot
fjprot  = 1.0 * F-value for tf coil winding pack current density

ixc(24) = 56 * tdmptf
tdmptf  = 25.0 * Dump time for tf coil (s)

ixc(25) = 57 * thkcas
thkcas  = 0.5 * Inboard tf coil case outer (non-plasma side) thickness (m)

ixc(26) = 58 * thwcndut
boundl(58) = 0.008
thwcndut   = 0.008 * Tf coil conduit case thickness (m)

ixc(27) = 61 * gapds
boundl(61) = 0.02
boundu(61) = 0.12
gapds      = 0.12 * Gap between inboard vacuum vessel and tf coil (m)
* Why is this an iteration variable?

ixc(28) = 102 * fimpvar
* See impurity variables

ixc(29) = 103 * flhthresh
boundu(103) = 10.0
flhthresh   = 1.35 * F-value for l-h power threshold

ixc(30) = 117 *fpsepbqar

ixc(31) = 113 *ftaucq

ixc(32) = 60 * cpttf
boundl(60) = 6.0e4
boundu(60) = 9.0e4
cpttf      = 6.5e+04 * Tf coil current per turn (a)

ixc(33) = 59 * copper fraction of cable conductor (TF coils)
boundu(59) = 0.94
fcutfsu    = 0.8

ixc(34) = 54 * ftmargtf

ixc(35) = 65 * tohs
boundl(65) = 290.0
boundu(65) = 310.0
tohs   = 300 * OH ramp up time (s)

ixc(36) = 118 * fpsep: f-value to ensure separatrix power is related to that from Kallenbach divertor
boundl(118) = 0.85
boundu(118)=1.15

ixc(37) = 119 * tesep
boundl(119) = 0.1
boundu(119) = 10.0
tesep       = 0.28 * Electron temperature at separatrix (kev) (ipedestal=1)

ixc(38) = 120 * ttarget  Plasma temperature adjacent to divertor sheath [eV]
boundl(120) = 0.1
boundu(120) = 10.0
ttarget     = 2.3  * Plasma temperature adjacent to divertor sheath [eV]

ixc(39) = 21 * ftburn f-value for burn time limit equation
boundl(21) = 0.001
boundu(21) = 1.002
ftburn   = 1.0 * F-value for minimum burn time

ixc(40) = 106 * ftmargoh (f-value for equation 60)

ixc(41) = 115 * fpoloidalpower: f-value for max rate of change of energy in poloidal field

ixc(42) = 46 * fpinj (f-value for equation 30)

ixc(43) = 122 * oh_steel_frac : streel fraction of OH coil
oh_steel_frac = 0.5  * central solenoid steel fraction (iteration variable 122)

ixc(44) = 123 * foh_stress : f-value for CS coil Tresca stress limit (see asltroh)

*-----------------Build Variables------------------*

blnkith  = 0.755 * Inboard blanket thickness (m);
blnkoth  = 1.275 * Outboard blanket thickness (m);
ddwex    = 0.15 * Cryostat thickness (m)
ddwi     = 0.32 * Vacuum vessel thickness (tf coil / shield) (m)
gapomin  = 0.20 * Minimum gap between outboard vacuum vessel and tf coil (m)
iohcl    = 1 * Switch for existence of central solenoid;
scrapli  = 0.225 * Gap between plasma and first wall; inboard side (m)
scraplo  = 0.225 * Gap between plasma and first wall; outboard side (m)
shldith  = 0.30 * Inboard shield thickness (m)
shldoth  = 0.80 * Outboard shield thickness (m)
shldtth  = 0.30 * Upper/lower shield thickness (m);
vgap2    = 0.12 * Vertical gap between vacuum vessel and tf coil (m)
vgaptf   = 1.60 * Vertical gap between x-point and divertor (m)

*---------------Constraint Variables---------------*

fpnetel  = 1.0 * F-value for net electric power


*------------------Cost Variables------------------*

output_costs = 0
cost_model = 0
iavail   = 0 * Switch for plant availability model;
ifueltyp = 1 * Switch;

*-------------Current Drive Variables--------------*

bscfmax  = 0.99 * Maximum fraction of plasma current from bootstrap;
iefrf    = 10 * Switch for current drive efficiency model;
gamma_ecrh = 0.30 * ECRH gamma_CD (user input)
etaech = 0.4 * ECRH wall-plug efficiency


*----------------Divertor Variables----------------*

Kallenbach_switch = 1
Kallenbach_tests = 0
helium_enrichment = 1.0    * Ratio of helium concentration in SOL to confined plasma
impurity_enrichment=5.0d0  * Ratio of impurity concentrations in SOL to confined plasma
lambda_target=5.0d-3        * SOL power fall-off length at the target, perpendicular to field [m]
netau = 0.5                * Parameter describing the departure from local ionisation equilibrium in the SOL. [ms.1e20/m3]
lambda_q = 0.002
targetangle = 5.0          * Angle between field-line and divertor target (degrees)

qtargettotal = 5.0e6       * Power density on target including surface recombination [W/m2]
neratio = 0.75              * ratio of mean SOL density at OMP to separatrix density at OMP
*------------------Fwbs Variables------------------*

vfshld   = 0.60 * Coolant void fraction in shield

*-----------------Global Variables-----------------*


*-------------Heat Transport Variables-------------*

etath    = 0.375 * Thermal to electric conversion efficiency; input if ipowerflow=0
ipowerflow = 0 * Switch for power flow model;
primary_pumping = 0 * Switch for pumping power for primary coolant

* Set total primary electrical pumping power to 155 MW
htpmw_div = 0
htpmw_shld = 0
htpmw_blkt = 0 * blanket primary pumping power He (MW)
etahtp = 1.0 * mechanical pump wall-plug efficiency
htpmw_fw = 155 * first wall primary pumping power He (MW)

*------------------Ife Variables-------------------*


*------------Impurity Radiation Module-------------*

imprad_model = 1 * Switch for impurity radiation model;
coreradius = 0.75 * Normalised radius defining the 'core' region
coreradiationfraction = 0.6 * fraction of radiation from 'core' region that is subtracted from the loss pow
fimp(1) = 1.0
fimp(2) = 0.1
fimp(3) = 0.0
fimp(4) = 0.0
fimp(5) = 0.0
fimp(6) = 0.0
fimp(7) = 0.0
fimp(8) = 0.0
fimp(9) = 0.0
fimp(10) = 0.0
fimp(11) = 0.0
fimp(12) = 0.0
*fimp(13) = 0.000
fimp(14) = 5e-05
fimpvar  = 0.0004 * Impurity fraction to be used as fimp(impvar)

impvar   = 13 * Fimp element value to be varied if iteration

*---------------------Numerics---------------------*

ioptimz  = 1 * for optimisation VMCON only
minmax   = 1 * Switch for figure-of-merit (see lablmm for descriptions)
epsvmc   = 1.0e-4 * Error tolerance for vmcon
maxcal   = 100

*----------------Pf Power Variables----------------*

*-----------------Pfcoil Variables-----------------*

coheof   = 13540000.0 * Central solenoid overall current density at end of flat-top (a/m2)
cptdin   = 4.22d4, 4.22d4, 4.22d4, 4.22d4, 4.3d4, 4.3d4,  4.3d4, 4.3d4, * Peak current per turn input for pf coil i (a)

ipfloc   = 2,2,3,3 * Switch for locating scheme of pf coil group i;
isumatpf = 3 * Switch for superconductor material in pf coils;
ncls     = 1,1,2,2, * Number of pf coils in group j
ngrp     = 4 * Number of groups of pf coils;
ohhghf   = 0.9 * Central solenoid height / tf coil internal height
rjconpf  = 1.1d7, 1.1d7, 6.d6, 6.d6, 8.d6, 8.0d6, 8.0d6, 8.0d6, * Average winding pack current density of pf coil i (a/m2)
rpf2     = -1.825 * Offset (m) of radial position of ipfloc=2 pf coils
zref(1) = 3.6
zref(2) = 1.2
zref(3) = 1.0
zref(4) = 2.8
zref(5) = 1.0
zref(6) = 1.0
zref(7) = 1.0
zref(8) = 1.0

isumatoh = 5


*----------------Physics Variables-----------------*

alphan   = 1.00 * Density profile index
alphat   = 1.45 * Temperature profile index
aspect   = 3.1 * Aspect ratio (iteration variable 1)

dnbeta   = 3.0 * (troyon-like) coefficient for beta scaling;
fkzohm   = 1.0245 * Zohm elongation scaling adjustment factor (ishape=2; 3)
gamma    = 0.3 * Ejima coefficient for resistive startup v-s formula
hfact    = 1.1 * H factor on energy confinement times (iteration variable 10)

ibss     = 4 * Switch for bootstrap current scaling;
iculbl   = 1 * Switch for beta limit scaling (constraint equation 24);
icurr    = 4 * Switch for plasma current scaling to use;
idensl   = 7 * Switch for density limit to enforce (constraint equation 5);
ifalphap = 1 * Switch for fast alpha pressure calculation;
ifispact = 0 * Switch for neutronics calculations;
ipedestal = 1 * Switch for pedestal profiles;
iscdens = 1 * set pedestal-top density as fgwped * Greenwald density limit

fgwped = 0.85 * fraction of Greenwald density to set as pedestal-top density
neped    = 0.678e20 * Electron density of pedestal (/m3) (ipedestal=1)
nesep    = 0.5e20 * Electron density at separatrix (/m3) (ipedestal=1)
rhopedn  = 0.94 * R/a of density pedestal (ipedestal=1)
rhopedt  = 0.94 * R/a of temperature pedestal (ipedestal=1)
tbeta    = 2.0 * Temperature profile index beta  (ipedestal=1)
teped    = 5.5 * Electron temperature of pedestal (kev) (ipedestal=1)

iprofile = 1 * Switch for current profile consistency;
isc      = 34 * Switch for energy confinement time scaling law
ishape   = 2 * Switch for plasma cross-sectional shape calculation;

q0       = 1.0 * Safety factor on axis
ralpne   = 0.1 * Thermal alpha density / electron density (iteration variable 109)

snull    = 1 * Switch for single null / double null plasma;
ssync    = 0.6 * Synchrotron wall reflectivity factor

triang   = 0.5 * Plasma separatrix triangularity (calculated if ishape=1; 3 or 4)
zfear    = 1 * High-z impurity switch; 0=iron; 1=argon

*-----------------Pulse Variables------------------*

lpulse = 1 * Switch for reactor model;
tdwell = 0 * dwell time (s)

*-------------------Scan Module--------------------*
*-----------------Tfcoil Variables-----------------*
itfsup   = 1  * switch for TF coil conductor model 1=superconductor
isumattf = 5
casthi   = 0.06 * Inboard tf coil case inner (plasma side) thickness (m)
casths   = 0.05 * Inboard tf coil sidewall case thickness (m)


ripmax   = 0.6 * maximum allowable toroidal field ripple amplitude at plasma edge (%)

tfno     = 16 * Number of tf coils


dhecoil  = 0.010 * diameter of He coil in TF winding (m)
tftmp    = 4.750 * Peak helium coolant temperature in tf coils and pf coils (k)
thicndut = 0.0015 * Conduit insulation thickness (m)
tinstf   = 0.008 * Ground insulation thickness surrounding winding pack (m)
tmargmin = 1.500 * Minimum allowable temperature margin (cs and tf coils) (k)
vftf     = 0.300 * Coolant fraction of tfc 'cable' (itfsup=1)

*-----------------Times Variables------------------*

*-----------------Vacuum Variables-----------------*
