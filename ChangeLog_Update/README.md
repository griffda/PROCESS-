# Instructions on the new CHANGELOG procedure

## The New Process
From now onward, users who make changes to the Process code will no longer update these changes in the `CHANGELOG.md` file. Instead, each change will be documented in a `.yaml` (YAML) file inside the `ChangeLog_Update` directory. This is so there are no more CHANGELOG merge conflicts upon merging into develop from individual branches. 

## The Types of changes to be recorded
**Added**: For newly added features.

**Changed**: For documenting changes in the existing functionality.

**Deprecated**: For documenting soon-to-be removed features.

**Removed**: For listing now removed features.

**Fixed**: For documenting any bug fixes.



## How the YAML file will look
This is the general structure of the YAML file that will be generated by using the Python script (described below) and in turn will be translated ready for upload upon Process version upgrade which will be carried out by a RSE.

```BASH
Added:
  - "List any new features you have added here"

Changed:
  - "List any changes to existing functionality here"

Deprecated:
  - "List any soon-to-be removed features here"

Removed:
  - "List any features you have removed here"

Fixed:
  - "List any bug fixes here"
```

## Generating the YAML file with a Python script
An empty YAML file with the follwoing structure wil be generated in the ChangeLog_Update directory (`Process/ChangeLog_update`) when the Python script is run. The Python script will automatically extract the issue number that proceeds your Git branch and use this as the name for your generated YAML file e.g:

Current branch: `9999-This-is-my-issue`

The YAML file name generated in the `ChangeLog_Update` directory will be: `9999.yaml`.

### Step 1
In the terminal, run the python script `create_changelog.py`, e.g:

```bash
sgubbins@K1396:~/process python ChangeLog_Update/create_changelog.py
```
This script will create a .yaml file in the ChangeLog_Update directory where the name is that of your current git branch issue number.yaml. 

### Step 2
Look in the ChangeLog_Update dir for your generated YAML file (determined by issue number)- This means your issue must have been created by a merge request. If you do NOT have an issue number in fornt of your current branch name, then you must create a merge request so your branch includes this issue number.

### Step 3
Open your generated YAML file which will look like below:
```BASH
Added:
-
Changed:
-
Deprecated:
-
Fixed:
-
Removed:
-
```

### Step 4
Now you must add your changes to the YAML file manually. As seen in the section ['How the YAML file will look'](#how-the-yaml-file-will-look), each entry of a change is split into the aforementioned categories. You are able to have multiple changes per issue, and this just requires you to add another bullet point (hyphen) to a given category. An example of what the changes may look like if there are more than one can be seen below. **Syntax in the YAML file includes an important requirement for having a space between the hyphen and your text.**

Also, at the end of each comment under each header, please as in brackets your issue number after a hash (see below). This is so it is possible to track at which point the changes were made. If you have made a change that corresponds to multiple issues, please include these in the same format as seen in the example below.

```yaml
Added:
  - Added feature 1 (#1234)
  - Added feature 2 (#1234)
  - Added feature 3 (#1234)

Changed:
  - Changed feature 1 (#1234)
  - Changed feature 2 (#1234,#5678)

Deprecated:
  - 

Removed:
  - 

Fixed:
  - Fixed bug 1 (#1234)
```
Also, as seen above, if you haven't made changes, sections can be left empty. 

### Step 5
All you need to do now is save your YAML file once you have added the changes to it, commit these changes and that is all. No changes need to be made ot the CHANGELOG.md as this will be done automatically upon Process upversioning. 

## What warrants a changelog entry?
You can see the current CHANGELOG.md in the process directory, which has previous examples of what should be included in the changelog. Using [Gitlab guides](https://docs.gitlab.com/ee/development/changelog.html), a few key changelog entries are:

- Any user-facing change must have a changelog entry
- Any developer-facing chaneg (such as test suite changes) should **not** have a changelog entry
- A fix for regression introduced and then fixed in the same release (such as fixing a bug introduced during a monthly release candidate) should **not** have a changelog entry.

## Writing good changelog entries
A good changelog entry should be descriptive and concise. It should explain the change to the reader who has *zero context* about the change. See [here](https://docs.gitlab.com/ee/development/changelog.html) for more.

- **Bad**: Go to a project order.
- **Good**: Show a user's starred project at the top of the "Go to project" dropdown.


# Instructions for the RSE updating the CHANGELOG on upgrade of PROCESS

### Step 1
*This process should only be followed upon PROCESS upgrade i.e. from 2.4 to 2.5.*

From the terminal, run:
```bash
python ChangeLog_Update/changelog_upversion.py
```
This script will take the .yaml files in the `ChangeLog_Update` directory and using the jinja2 template, will combine the changes since the last Process upgrade by header as defined in the changelog dict (the headers seen above). Whoever is running the script will be asked whihc version of Process we are upgrading to. 

A markdown file- `ChangelogUpdate.md`, will be created in the same directory and all the YAML files will be removed so they cannot be uploaded more than once.

### Step 2
Navigate to the `ChangelogUpdate.md' file which should include the new version number (as input by you), the date of the running of the script (should be today), and then the content of the changes since the last upgrade.

Now, the content of this file should be copied and pasted into the CHANGELOG.md file that already exists in the process directory. 