stages:
  - build
  - testing
  - jenkins
before_script:
#  - apt-get install -y gfortran
#  - apt-get install -y python3-numpy
#  - apt-get install -y python3-scipy
#  - apt-get install -y python3-matplotlib
#  - apt-get install dos2unix
  - export LOGNAME=root
  - source /etc/profile.d/modules.sh
  - module use /usr/local/modules/default
  - module unload python
  - module load python/3.3
  - module load gfortran
#  - 
  - echo ld_library_path=$LD_LIBRARY_PATH

build:Make:
# image: ukaea/ubuntu

 only:
  - test_set_up 
 stage: build
 script:
  - pwd
  - gcc --version
  - export PYTHONPATH=$PYTHONPATH:${PWD}/utilities
  - export PATH=$PATH:${PWD}/utilities
#  - dos2unix global_variables.f90
  - ls -lah
  - make clean
  - make
#  - cd utilities
  - dos2unix ${PWD}/utilities/*.py
#  - ls -lah utilities/
#  - utilities/create_dicts.py
  - make dicts
  - cd test_suite
  - dos2unix test_suite.py
  - python test_suite.py -d 1.0
#  - ls -lah
  - echo "Test "
 artifacts:
   expire_in: 2 yrs
   paths:
     - test_suite/*.xunit
 tags:
  - freia
#after_script:  # Now trigger testing
#- "curl -X POST -F token=24e840ea1977a3283dd1288732e5d0 -F ref=develop https://git.ccfe.ac.uk/api/v4/projects/2172/trigger/pipeline"
