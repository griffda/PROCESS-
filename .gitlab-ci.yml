stages:
  - build
  - testing
  - jenkins
#This command is used for generating gtest results in Jenkins  ./bin/process_test.exe --gtest_output=xml:gtest_results.xml
before_script:
#  - apt-get install -y gfortran
#  - apt-get install -y python3-numpy
#  - apt-get install -y python3-scipy
#  - apt-get install -y python3-matplotlib
#  - apt-get install dos2unix
  - export LOGNAME=root
  - source /etc/profile.d/modules.sh
  - module use /usr/local/modules/default
  - module unload python
  - module load python/3.3
  - module load texlive/2017
  - module unload ifort 
  - module load gfortran
#  - 
  - echo ld_library_path=$LD_LIBRARY_PATH

build:Make:
# image: ukaea/ubuntu
 only:
  - develop_unit_tests
  - reinke_crit_unit_tests
 stage: build
 script:
  - pwd
  - gcc --version
  - ls -lah
  - rm -rf build
  - cmake3 -H. -Bbuild
  - cmake3 --build build
# Now add trigger for PROCESS_Testing on GitLab CI               develop is PROCESS_Testing branch
  - "curl -X POST -F token=24e840ea1977a3283dd1288732e5d0 -F ref=develop https://git.ccfe.ac.uk/api/v4/projects/2172/trigger/pipeline"  
  - ls bin -lah
  - echo "Test "
 artifacts:
   expire_in: 2 hrs
   paths:
     - bin/process.exe
     - bin/libPROCESS_calc_engine.so
 tags:
  - freia
build:vardes:

 only:
  - reinke_crit_unit_tests
  - develop_unit_tests
 stage: build
 script:
  - pwd
  - gcc --version
  - ls -lah
  - cmake3 -H. -Bbuild
  - cmake3 --build build --target vardes
 artifacts:
   expire_in: 2 hrs
   paths:
     - documentation/html/*.html
 tags:
  - freia
testing:test_suite:
 when: on_success  # Also default setting
 only:
  - reinke_crit_unit_tests
  - develop_unit_tests
 stage: testing
 script:
  - pwd
  # Now trigger testing on Jenkins
#  - "curl -X POST http://mkumar:0eb1252f76a609d527edfbfdc0559eae@process-jenkins-ci.apps.l:8080/jenkins/job/PROCESS/build?token=MiLNGc-QvyEevhKK54go"
 tags:
  - freia

#after_script:  # Now trigger testing
#- "curl -X POST -F token=24e840ea1977a3283dd1288732e5d0 -F ref=develop https://git.ccfe.ac.uk/api/v4/projects/2172/trigger/pipeline"
